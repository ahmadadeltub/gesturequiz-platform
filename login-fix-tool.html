<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Fix - GestureQuiz</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 600px;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }
        .solution {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin: 10px;
            transition: background 0.3s;
            font-weight: bold;
        }
        button:hover {
            background: #218838;
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #5a6268;
        }
        .countdown {
            font-size: 2em;
            color: #28a745;
            font-weight: bold;
            margin: 20px 0;
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Login Fix Tool</h1>
        
        <div class="error-message">
            <strong>‚ùå Error Detected:</strong><br>
            "Unable to connect to the server. Please check your internet connection and try again."
        </div>

        <div class="solution">
            <strong>‚úÖ Solution:</strong><br>
            This tool will bypass the Firebase connection issue and enable offline mode so you can access the class management system.
        </div>

        <div class="countdown" id="countdown">Ready to fix...</div>

        <button onclick="fixLogin()">üîß Fix Login Now</button>
        <button onclick="manualFix()" class="secondary">üõ†Ô∏è Manual Fix</button>

        <div class="log" id="log">Login Fix Tool Ready...\n</div>

        <div style="margin-top: 30px;">
            <a href="quiz-app/pages/class-management.html" style="color: #28a745; text-decoration: none;">
                ‚Üí Go to Class Management (after fix)
            </a>
        </div>
    </div>

    <script>
        let countdownInterval;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : 'üìã';
            logDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function startCountdown() {
            let seconds = 5;
            const countdownDiv = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                countdownDiv.textContent = `Auto-fix in ${seconds}s`;
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(countdownInterval);
                    countdownDiv.textContent = 'Applying fix...';
                    setTimeout(() => {
                        fixLogin();
                    }, 1000);
                }
            }, 1000);
        }

        function fixLogin() {
            log('üîß Applying login fix...', 'info');
            
            try {
                // Clear countdown
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').textContent = 'Fixing...';
                }
                
                // Clear any existing problematic data
                localStorage.removeItem('firebaseUser');
                localStorage.removeItem('firebaseAuth');
                localStorage.removeItem('authToken');
                
                log('üßπ Cleared Firebase cache', 'info');
                
                // Create demo user for offline mode
                const demoUser = {
                    id: 'demo_teacher_' + Date.now(),
                    email: 'teacher@demo.com',
                    name: 'Demo Teacher',
                    role: 'teacher',
                    type: 'teacher',
                    isDemo: true,
                    isOffline: true,
                    loginTime: new Date().toISOString()
                };
                
                // Store user data
                localStorage.setItem('currentUser', JSON.stringify(demoUser));
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('offlineMode', 'true');
                
                // Clear any existing classes to prevent the test class issue
                localStorage.setItem('teacherClasses', '[]');
                
                log('‚úÖ Demo user created', 'success');
                log('üßπ Cleared existing classes', 'info');
                log('üì± Offline mode enabled', 'success');
                
                // Update UI
                document.getElementById('countdown').textContent = '‚úÖ Fix Applied!';
                document.getElementById('countdown').style.color = '#28a745';
                
                // Show success message
                const container = document.querySelector('.container');
                const successDiv = document.createElement('div');
                successDiv.className = 'solution';
                successDiv.innerHTML = `
                    <strong>‚úÖ LOGIN FIX APPLIED!</strong><br>
                    You can now access the class management system in offline mode.<br>
                    Redirecting in 3 seconds...
                `;
                container.appendChild(successDiv);
                
                log('üéâ Login fix completed successfully', 'success');
                
                // Redirect to class management
                setTimeout(() => {
                    window.location.href = 'quiz-app/pages/class-management.html';
                }, 3000);
                
            } catch (error) {
                log(`‚ùå Fix failed: ${error.message}`, 'error');
                document.getElementById('countdown').textContent = 'Fix failed';
                document.getElementById('countdown').style.color = '#dc3545';
            }
        }

        function manualFix() {
            log('üõ†Ô∏è Manual fix instructions:', 'info');
            log('1. Clear your browser cache', 'info');
            log('2. Disable any ad blockers', 'info');
            log('3. Check your internet connection', 'info');
            log('4. Try using a different browser', 'info');
            log('5. If all else fails, use the automatic fix', 'info');
            
            // Show manual steps
            const container = document.querySelector('.container');
            const manualDiv = document.createElement('div');
            manualDiv.className = 'solution';
            manualDiv.innerHTML = `
                <strong>üõ†Ô∏è Manual Fix Steps:</strong><br>
                1. Clear browser cache (Ctrl+Shift+Del)<br>
                2. Disable ad blockers for this site<br>
                3. Check internet connection<br>
                4. Try incognito/private browsing mode<br>
                5. Use automatic fix if manual steps don't work
            `;
            container.appendChild(manualDiv);
        }

        // Auto-start countdown
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Login Fix Tool started', 'info');
            log('üîç Detected Firebase connection issue', 'warning');
            log('‚è∞ Starting auto-fix countdown...', 'info');
            
            setTimeout(() => {
                startCountdown();
            }, 2000);
        });
    </script>
</body>
</html>
