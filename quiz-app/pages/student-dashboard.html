<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - GestureQuiz</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-600: #0284c7;
            --primary-700: #0369a1;
            --primary-50: #f0f9ff;
            --primary-100: #e0f2fe;
            --accent-500: #8b5cf6;
            --accent-600: #7c3aed;
            --accent-50: #f5f3ff;
            --success-500: #22c55e;
            --success-600: #16a34a;
            --success-50: #f0fdf4;
            --warning-500: #f59e0b;
            --warning-50: #fffbeb;
            --danger-500: #ef4444;
            --danger-50: #fef2f2;
            --neutral-50: #fafafa;
            --neutral-100: #f5f5f5;
            --neutral-200: #e5e5e5;
            --neutral-300: #d4d4d4;
            --neutral-400: #a3a3a3;
            --neutral-500: #737373;
            --neutral-600: #525252;
            --neutral-700: #404040;
            --neutral-800: #262626;
            --neutral-900: #171717;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --transition-all: all 0.3s ease;
            --transition-colors: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--accent-50) 100%);
            color: var(--neutral-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--neutral-200);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-4) var(--space-6);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary-600);
            text-decoration: none;
        }

        .logo i {
            font-size: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-100);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-600);
        }

        .user-details h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--neutral-800);
        }

        .user-details p {
            font-size: 0.8rem;
            color: var(--neutral-500);
        }

        /* Main Content */
        .main-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
        }

        .welcome-section {
            text-align: center;
            margin-bottom: var(--space-12);
            padding: var(--space-8) var(--space-4);
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: var(--radius-3xl);
            border: 1px solid var(--neutral-200);
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-4);
            animation: fadeInUp 0.6s ease;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--neutral-600);
            margin-bottom: var(--space-6);
            animation: fadeInUp 0.8s ease;
        }

        .quick-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            margin-top: var(--space-6);
            animation: fadeInUp 1s ease;
        }

        .quick-action-btn {
            background: var(--primary-600);
            color: white;
            border: none;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-xl);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-all);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.9rem;
        }

        .quick-action-btn:hover {
            background: var(--primary-700);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .quick-action-btn.secondary {
            background: var(--accent-500);
        }

        .quick-action-btn.secondary:hover {
            background: var(--accent-600);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Stats Overview */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-12);
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--neutral-100);
            transition: var(--transition-all);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--accent-500));
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .stat-card.primary::before {
            background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
        }

        .stat-card.success::before {
            background: linear-gradient(90deg, var(--success-500), var(--success-600));
        }

        .stat-card.accent::before {
            background: linear-gradient(90deg, var(--accent-500), var(--accent-600));
        }

        .stat-card.warning::before {
            background: linear-gradient(90deg, var(--warning-500), #f59e0b);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-icon.primary {
            background: var(--primary-100);
            color: var(--primary-600);
        }

        .stat-icon.success {
            background: var(--success-50);
            color: var(--success-600);
        }

        .stat-icon.accent {
            background: var(--accent-50);
            color: var(--accent-600);
        }

        .stat-icon.warning {
            background: var(--warning-50);
            color: var(--warning-500);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--neutral-900);
            margin-bottom: var(--space-2);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--neutral-600);
            font-weight: 500;
        }

        .stat-progress {
            margin-top: var(--space-3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--neutral-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-500), var(--success-600));
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--neutral-500);
            margin-top: var(--space-1);
        }

        /* Quizzes Section */
        .section {
            margin-bottom: var(--space-12);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--neutral-900);
        }

        .section-subtitle {
            font-size: 1rem;
            color: var(--neutral-600);
            margin-top: var(--space-1);
        }

        /* Quiz Grid */
        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-6);
        }

        .quiz-card {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--neutral-100);
            transition: var(--transition-all);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease;
        }

        .quiz-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-xl);
        }

        .quiz-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-500), var(--accent-500));
        }

        .quiz-card.completed::before {
            background: linear-gradient(90deg, var(--success-500), var(--success-600));
        }

        .quiz-card.new::before {
            background: linear-gradient(90deg, var(--accent-500), var(--accent-600));
        }

        .quiz-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .quiz-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--space-2);
            line-height: 1.4;
        }

        .quiz-meta {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .quiz-meta span {
            font-size: 0.8rem;
            color: var(--neutral-500);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .difficulty-badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .difficulty-easy {
            background: var(--success-50);
            color: var(--success-600);
        }

        .difficulty-medium {
            background: var(--warning-50);
            color: var(--warning-500);
        }

        .difficulty-hard {
            background: var(--danger-50);
            color: var(--danger-500);
        }

        .quiz-description {
            color: var(--neutral-600);
            font-size: 0.9rem;
            margin-bottom: var(--space-4);
            line-height: 1.5;
        }

        .quiz-actions {
            display: flex;
            gap: var(--space-3);
        }

        /* Buttons */
        .btn {
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.9rem;
            border: none;
            cursor: pointer;
            transition: var(--transition-all);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            text-decoration: none;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary-600);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-700);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--neutral-600);
            border: 1px solid var(--neutral-300);
        }

        .btn-outline:hover {
            background: var(--neutral-50);
            border-color: var(--neutral-400);
        }

        .btn-success {
            background: var(--success-500);
            color: white;
        }

        .btn-success:hover {
            background: var(--success-600);
            transform: translateY(-1px);
        }

        .btn-full {
            width: 100%;
        }

        /* Activity Feed */
        .activity-feed {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--neutral-100);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-3);
            transition: var(--transition-colors);
        }

        .activity-item:hover {
            background: var(--neutral-50);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .activity-content h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--space-1);
        }

        .activity-content p {
            font-size: 0.8rem;
            color: var(--neutral-500);
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--neutral-400);
            margin-left: auto;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-16) var(--space-8);
            color: var(--neutral-500);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: var(--space-4);
            color: var(--neutral-300);
        }

        .empty-state h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--neutral-700);
        }

        .empty-state p {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: var(--space-4);
            }

            .main-content {
                padding: var(--space-6) var(--space-4);
            }

            .welcome-title {
                font-size: 2rem;
            }

            .welcome-subtitle {
                font-size: 1rem;
            }

            .quick-actions {
                flex-direction: column;
                align-items: center;
                gap: var(--space-3);
            }

            .quick-action-btn {
                width: 100%;
                max-width: 300px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .quiz-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-3);
            }

            .user-details {
                display: none;
            }

            .notification {
                right: 10px !important;
                left: 10px !important;
                max-width: none !important;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 1.75rem;
            }

            .welcome-section {
                padding: var(--space-6) var(--space-4);
            }

            .quiz-card {
                padding: var(--space-4);
            }

            .btn {
                padding: var(--space-2) var(--space-3);
                font-size: 0.8rem;
            }

            .stat-card {
                padding: var(--space-4);
            }

            .stat-number {
                font-size: 1.5rem;
            }
        }

        /* Footer */
        .footer {
            background: var(--neutral-800);
            color: var(--neutral-200);
            padding: var(--space-8) 0;
            margin-top: var(--space-16);
        }

        .footer-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 var(--space-6);
            text-align: center;
        }

        .footer-content h3 {
            color: var(--primary-400);
            margin-bottom: var(--space-4);
            font-size: 1.25rem;
        }

        .footer-content p {
            margin-bottom: var(--space-2);
            color: var(--neutral-400);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--space-6);
            margin-top: var(--space-6);
        }

        .footer-links a {
            color: var(--neutral-400);
            text-decoration: none;
            transition: var(--transition-colors);
        }

        .footer-links a:hover {
            color: var(--primary-400);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--neutral-300);
            border-radius: 50%;
            border-top-color: var(--primary-600);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Logout Button */
        .logout-btn {
            background: var(--danger-500);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-all);
        }

        .logout-btn:hover {
            background: var(--danger-600);
        }

        /* Profile Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary-600);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #666;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition-all);
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: var(--danger-600);
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition-all);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .profile-picture-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 10px;
        }

        .current-avatar {
            font-size: 3rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--primary-100);
            border-radius: 50%;
            background: var(--primary-50);
        }

        .profile-upload-options {
            flex: 1;
        }

        .profile-upload-options h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 14px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fafafa;
        }

        .emoji-option {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: var(--transition-all);
            border: 2px solid transparent;
        }

        .emoji-option:hover {
            background: var(--primary-100);
            transform: scale(1.1);
        }

        .emoji-option.selected {
            background: var(--primary-500);
            border-color: var(--primary-600);
            transform: scale(1.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-all);
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-outline {
            background: white;
            color: #666;
            border: 2px solid #ddd;
        }

        .btn-outline:hover {
            background: #f5f5f5;
            border-color: #bbb;
        }

        .btn-primary {
            background: var(--primary-500);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-600);
            transform: translateY(-1px);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .user-avatar {
            cursor: pointer;
            transition: var(--transition-all);
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="../index.html" class="logo">
                <i class="fas fa-hand-paper"></i>
                GestureQuiz
            </a>
            <div class="user-profile">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar" onclick="openProfileModal()" title="Click to edit profile">S</div>
                    <div class="user-details">
                        <h3 id="userName">Loading...</h3>
                        <p>Student</p>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">Welcome to Your Learning Journey! üéì</h1>
            <p class="welcome-subtitle">Master new skills through interactive gesture-based quizzes</p>
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="findRandomQuiz()">
                    <i class="fas fa-random"></i>
                    Random Quiz
                </button>
                <button class="quick-action-btn secondary" onclick="viewProgress()">
                    <i class="fas fa-chart-line"></i>
                    My Progress
                </button>
                <button class="quick-action-btn" onclick="refreshData()">
                    <i class="fas fa-sync"></i>
                    Refresh Data
                </button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card primary">
                <div class="stat-header">
                    <div class="stat-icon primary">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                </div>
                <div class="stat-number" id="completedQuizzes">0</div>
                <div class="stat-label">Completed Quizzes</div>
                <div class="stat-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="completedProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="completedText">0% of available quizzes</div>
                </div>
            </div>

            <div class="stat-card success">
                <div class="stat-header">
                    <div class="stat-icon success">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div class="stat-number" id="averageScore">0%</div>
                <div class="stat-label">Average Score</div>
                <div class="stat-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="scoreProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="scoreText">Keep practicing to improve!</div>
                </div>
            </div>

            <div class="stat-card accent">
                <div class="stat-header">
                    <div class="stat-icon accent">
                        <i class="fas fa-fire"></i>
                    </div>
                </div>
                <div class="stat-number" id="streakDays">0</div>
                <div class="stat-label">Day Learning Streak</div>
                <div class="stat-progress">
                    <div class="progress-text" id="streakText">Start your learning streak today!</div>
                </div>
            </div>

            <div class="stat-card warning">
                <div class="stat-header">
                    <div class="stat-icon warning">
                        <i class="fas fa-trophy"></i>
                    </div>
                </div>
                <div class="stat-number" id="totalPoints">0</div>
                <div class="stat-label">Total Points</div>
                <div class="stat-progress">
                    <div class="progress-text" id="pointsText">Earn points by completing quizzes!</div>
                </div>
            </div>
        </div>

        <!-- Available Quizzes Section -->
        <section class="section">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Available Quizzes</h2>
                    <p class="section-subtitle">Choose a quiz to start your learning journey</p>
                </div>
                <button class="btn btn-outline" onclick="refreshQuizzes()">
                    <i class="fas fa-refresh"></i>
                    Refresh
                </button>
            </div>
            <div class="quiz-grid" id="quizGrid">
                <!-- Quizzes will be loaded here -->
            </div>
        </section>

        <!-- Recent Activity Section -->
        <section class="section">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Recent Activity</h2>
                    <p class="section-subtitle">Your latest quiz attempts and achievements</p>
                </div>
            </div>
            <div class="activity-feed" id="activityFeed">
                <!-- Activity will be loaded here -->
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <h3>GestureQuiz</h3>
            <p>Empowering students through interactive gesture-based learning</p>
            <p>&copy; 2024 GestureQuiz. All rights reserved.</p>
            <div class="footer-links">
                <a href="../index.html">Home</a>
                <a href="javascript:void(0)" onclick="showNotification('Help system coming soon!', 'info')">Help</a>
                <a href="javascript:void(0)" onclick="showNotification('Contact support at support@gesturequiz.com', 'info')">Support</a>
            </div>
        </div>
    </footer>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Profile</h2>
                <button class="close-btn" onclick="closeProfileModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="profileForm">
                    <div class="form-group">
                        <label for="profileName">Name</label>
                        <input type="text" id="profileName" name="profileName" required>
                    </div>
                    <div class="form-group">
                        <label for="profileEmail">Email</label>
                        <input type="email" id="profileEmail" name="profileEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label for="profileGrade">Grade Level</label>
                        <select id="profileGrade" name="profileGrade">
                            <option value="">Select your grade</option>
                            <option value="1st Grade">1st Grade</option>
                            <option value="2nd Grade">2nd Grade</option>
                            <option value="3rd Grade">3rd Grade</option>
                            <option value="4th Grade">4th Grade</option>
                            <option value="5th Grade">5th Grade</option>
                            <option value="6th Grade">6th Grade</option>
                            <option value="7th Grade">7th Grade</option>
                            <option value="8th Grade">8th Grade</option>
                            <option value="9th Grade">9th Grade</option>
                            <option value="10th Grade">10th Grade</option>
                            <option value="11th Grade">11th Grade</option>
                            <option value="12th Grade">12th Grade</option>
                            <option value="College Freshman">College Freshman</option>
                            <option value="College Sophomore">College Sophomore</option>
                            <option value="College Junior">College Junior</option>
                            <option value="College Senior">College Senior</option>
                            <option value="Graduate">Graduate Student</option>
                            <option value="Adult Learner">Adult Learner</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="profileSchool">School Name</label>
                        <input type="text" id="profileSchool" name="profileSchool" placeholder="Enter your school name">
                    </div>
                    <div class="form-group">
                        <label>Profile Picture</label>
                        <div class="profile-picture-section">
                            <div class="current-avatar" id="currentProfileAvatar">üë®‚Äçüéì</div>
                            <div class="profile-upload-options">
                                <h4>Choose an Avatar:</h4>
                                <div class="emoji-grid">
                                    <div class="emoji-option" data-emoji="üë®‚Äçüéì">üë®‚Äçüéì</div>
                                    <div class="emoji-option" data-emoji="üë©‚Äçüéì">üë©‚Äçüéì</div>
                                    <div class="emoji-option" data-emoji="üßë‚Äçüéì">üßë‚Äçüéì</div>
                                    <div class="emoji-option" data-emoji="üë®‚Äçüíª">üë®‚Äçüíª</div>
                                    <div class="emoji-option" data-emoji="üë©‚Äçüíª">üë©‚Äçüíª</div>
                                    <div class="emoji-option" data-emoji="üßë‚Äçüíª">üßë‚Äçüíª</div>
                                    <div class="emoji-option" data-emoji="üë®‚Äçüî¨">üë®‚Äçüî¨</div>
                                    <div class="emoji-option" data-emoji="üë©‚Äçüî¨">üë©‚Äçüî¨</div>
                                    <div class="emoji-option" data-emoji="üßë‚Äçüî¨">üßë‚Äçüî¨</div>
                                    <div class="emoji-option" data-emoji="üë®‚Äçüé®">üë®‚Äçüé®</div>
                                    <div class="emoji-option" data-emoji="üë©‚Äçüé®">üë©‚Äçüé®</div>
                                    <div class="emoji-option" data-emoji="üßë‚Äçüé®">üßë‚Äçüé®</div>
                                    <div class="emoji-option" data-emoji="üë®‚Äçüìö">üë®‚Äçüìö</div>
                                    <div class="emoji-option" data-emoji="üë©‚Äçüìö">üë©‚Äçüìö</div>
                                    <div class="emoji-option" data-emoji="üßë‚Äçüìö">üßë‚Äçüìö</div>
                                    <div class="emoji-option" data-emoji="üéØ">üéØ</div>
                                    <div class="emoji-option" data-emoji="üìö">üìö</div>
                                    <div class="emoji-option" data-emoji="üéì">üéì</div>
                                    <div class="emoji-option" data-emoji="üìù">üìù</div>
                                    <div class="emoji-option" data-emoji="üèÜ">üèÜ</div>
                                    <div class="emoji-option" data-emoji="‚≠ê">‚≠ê</div>
                                    <div class="emoji-option" data-emoji="üöÄ">üöÄ</div>
                                    <div class="emoji-option" data-emoji="üí°">üí°</div>
                                    <div class="emoji-option" data-emoji="üé®">üé®</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeProfileModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="../js/firebase-config.js?v=20250709-003"></script>
    
    <!-- GestureQuiz Scripts -->
    <script src="../js/firebase-data-manager.js?v=20250709-003"></script>
    <script src="../js/firebase-auth.js?v=20250709-003"></script>
    <script src="../js/live-data-manager.js?v=20250709-003"></script>
    <script src="../js/api-simulator.js?v=20250709-003"></script>
    <script src="../js/data-integration.js?v=20250709-003"></script>
    <script src="../js/notification-system.js?v=20250709-003"></script>
    <script>
        let currentUser = {};
        let firebaseDataManager = null;
        let firebaseAuth = null;
        let dataIntegration = null;
        let dataManager = null;
        let apiClient = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeDashboard();
        });

        async function initializeDashboard() {
            try {
                // Initialize Firebase
                firebaseDataManager = new FirebaseDataManager();
                await firebaseDataManager.initialize();
                
                firebaseAuth = new FirebaseAuthManager();
                await firebaseAuth.initialize();
                
                // Check authentication
                currentUser = firebaseAuth.getCurrentUser();
                if (!currentUser || currentUser.role !== 'student') {
                    // Try localStorage fallback for test users
                    const localUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    if (!localUser.email || localUser.role !== 'student') {
                        window.location.href = '../index.html';
                        return;
                    }
                    currentUser = localUser;
                }

                // Initialize all data management systems
                dataIntegration = new DataIntegration();
                dataManager = new LiveDataManager();
                apiClient = new APISimulator();
                
                // Setup real-time updates
                setupRealTimeUpdates();
                
                // Override refresh function for real-time sync
                dataIntegration.refreshDisplays = function() {
                    loadUserData();
                    loadQuizzes();
                    loadStatistics();
                    loadRecentActivity();
                };

                // Load user data
                loadUserData();
                
                // Load quiz data
                await loadQuizzes();
                
                // Load statistics
                loadStatistics();
                
                // Load recent activity
                loadRecentActivity();
                
                // Set up auto-refresh
                setInterval(refreshData, 30000); // Refresh every 30 seconds
                
                // Show welcome message
                showNotification(`Welcome back, ${currentUser.name}!`, 'success');
                
            } catch (error) {
                console.error('‚ùå Dashboard initialization failed:', error);
                showNotification('Dashboard initialization failed. Using offline mode.', 'warning');
                
                // Fallback to localStorage mode
                initializeOfflineMode();
            }
        }

        function initializeOfflineMode() {
            // Check authentication with localStorage
            currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (!currentUser.email || currentUser.role !== 'student') {
                window.location.href = '../index.html';
                return;
            }

            // Initialize data management systems
            dataIntegration = new DataIntegration();
            dataManager = new LiveDataManager();
            apiClient = new APISimulator();
            
            // Setup real-time updates
            setupRealTimeUpdates();
            
            // Override refresh function for real-time sync
            dataIntegration.refreshDisplays = function() {
                loadUserData();
                loadQuizzes();
                loadStatistics();
                loadRecentActivity();
            };

            // Load user data
            loadUserData();
            
            // Load quiz data
            loadQuizzes();
            
            // Load statistics
            loadStatistics();
            
            // Load recent activity
            loadRecentActivity();
            
            // Set up auto-refresh
            setInterval(refreshData, 30000);
            
            // Show welcome message
            setTimeout(() => {
                showNotification(`Welcome back, ${currentUser.name || 'Student'}! üéì`, 'success');
            }, 1000);
        }

        function loadUserData() {
            const userName = currentUser.name || 'Student';
            document.getElementById('userName').textContent = userName;
            document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();
            document.getElementById('welcomeTitle').textContent = `Welcome back, ${userName}! üéì`;
        }

        function loadQuizzes() {
            if (!dataIntegration) return;
            
            // Get quizzes from integrated data system
            const availableQuizzes = dataIntegration.getAvailableQuizzes();
            const completedQuizzes = dataIntegration.getCompletedQuizzes();
            const studentProgress = dataIntegration.getStudentProgress();
            
            // Get all quizzes for display
            const allQuizzes = dataIntegration.getQuizzes();
            
            renderQuizzes(allQuizzes, completedQuizzes, studentProgress);
        }

        function renderQuizzes(quizzesToRender, completedQuizzes, studentProgress) {
            const quizGrid = document.getElementById('quizGrid');
            
            if (quizzesToRender.length === 0) {
                quizGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>No Quizzes Available</h3>
                        <p>Your teacher hasn't assigned any quizzes yet. Check back later!</p>
                        <button class="btn btn-primary" onclick="refreshQuizzes()" style="margin-top: 16px;">
                            <i class="fas fa-refresh"></i> Refresh Quizzes
                        </button>
                    </div>
                `;
                return;
            }

            quizGrid.innerHTML = quizzesToRender.map((quiz, index) => {
                const userResults = studentProgress ? studentProgress.filter(result => result.quizId === quiz.id) : [];
                const hasCompleted = userResults.length > 0;
                const bestScore = hasCompleted ? Math.max(...userResults.map(r => r.score)) : 0;
                const attemptCount = userResults.length;
                
                // Get class info
                const classInfo = dataIntegration.getClasses().find(c => c.id === quiz.classId);
                const className = classInfo ? classInfo.name : 'Unknown Class';
                
                // Determine card class based on completion status
                const cardClass = hasCompleted ? 'completed' : 'new';
                
                return `
                    <div class="quiz-card ${cardClass}" onclick="startQuiz('${quiz.id}')" style="animation-delay: ${index * 0.1}s">
                        <div class="quiz-header">
                            <div class="quiz-info">
                                <h3>${quiz.title}</h3>
                                <div class="quiz-meta">
                                    <span><i class="fas fa-clock"></i> ${quiz.questions?.length || 0} questions</span>
                                    <span><i class="fas fa-chalkboard-teacher"></i> ${className}</span>
                                    <span><i class="fas fa-user-graduate"></i> ${quiz.subject || 'General'}</span>
                                    <span class="difficulty-badge difficulty-${quiz.difficulty?.toLowerCase() || 'medium'}">
                                        ${quiz.difficulty || 'Medium'}
                                    </span>
                                </div>
                            </div>
                            ${hasCompleted ? `
                                <div class="quiz-status">
                                    <div style="text-align: center;">
                                        <div style="color: var(--success-600); font-weight: 600; font-size: 0.9rem;">
                                            <i class="fas fa-check-circle"></i> Completed
                                        </div>
                                        <div style="color: var(--neutral-600); font-size: 0.8rem;">
                                            Best: ${bestScore}%
                                        </div>
                                        <div style="color: var(--neutral-500); font-size: 0.75rem;">
                                            ${attemptCount} attempt${attemptCount > 1 ? 's' : ''}
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="quiz-status">
                                    <div style="text-align: center;">
                                        <div style="color: var(--primary-600); font-weight: 600; font-size: 0.9rem;">
                                            <i class="fas fa-play-circle"></i> New
                                        </div>
                                        <div style="color: var(--neutral-600); font-size: 0.8rem;">
                                            Ready to start
                                        </div>
                                    </div>
                                </div>
                            `}
                        </div>
                        <p class="quiz-description">
                            ${quiz.description || 'Test your knowledge with this interactive quiz'}
                        </p>
                        <div class="quiz-actions">
                            <button class="btn ${hasCompleted ? 'btn-outline' : 'btn-primary'} btn-full" 
                                    onclick="event.stopPropagation(); startQuiz('${quiz.id}')">
                                <i class="fas fa-${hasCompleted ? 'redo' : 'play'}"></i>
                                ${hasCompleted ? 'Retake Quiz' : 'Start Quiz'}
                            </button>
                            ${hasCompleted ? `
                                <button class="btn btn-success btn-full" 
                                        onclick="event.stopPropagation(); viewQuizResults('${quiz.id}')" 
                                        style="margin-top: 8px;">
                                    <i class="fas fa-chart-bar"></i>
                                    View Results
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadStatistics() {
            if (!dataIntegration) return;
            
            const studentProgress = dataIntegration.getStudentProgress();
            const allQuizzes = dataIntegration.getQuizzes();
            const availableQuizzes = dataIntegration.getAvailableQuizzes();
            const completedQuizzes = dataIntegration.getCompletedQuizzes();
            
            // Completed quizzes
            const completedCount = completedQuizzes.length;
            const totalQuizzes = allQuizzes.length;
            const completionRate = totalQuizzes > 0 ? (completedCount / totalQuizzes) * 100 : 0;
            
            document.getElementById('completedQuizzes').textContent = completedCount;
            document.getElementById('completedProgress').style.width = completionRate + '%';
            document.getElementById('completedText').textContent = 
                `${Math.round(completionRate)}% of ${totalQuizzes} available quizzes`;

            // Average score
            const averageScore = studentProgress.length > 0 
                ? studentProgress.reduce((sum, result) => sum + result.score, 0) / studentProgress.length 
                : 0;
            
            document.getElementById('averageScore').textContent = Math.round(averageScore) + '%';
            document.getElementById('scoreProgress').style.width = averageScore + '%';
            
            if (averageScore >= 90) {
                document.getElementById('scoreText').textContent = 'Excellent work! üåü';
            } else if (averageScore >= 70) {
                document.getElementById('scoreText').textContent = 'Good progress! Keep it up! üëç';
            } else if (averageScore > 0) {
                document.getElementById('scoreText').textContent = 'Keep practicing to improve! üìö';
            } else {
                document.getElementById('scoreText').textContent = 'Start taking quizzes to see your score!';
            }

            // Learning streak (simplified - based on recent activity)
            const recentDays = getRecentActivityDays(studentProgress);
            document.getElementById('streakDays').textContent = recentDays;
            
            if (recentDays > 0) {
                document.getElementById('streakText').textContent = 
                    recentDays === 1 ? 'Great start! Keep the momentum!' : 
                    `Amazing! ${recentDays} days of learning!`;
            }

            // Total points (score-based)
            const totalPoints = studentProgress.reduce((sum, result) => sum + result.score, 0);
            document.getElementById('totalPoints').textContent = totalPoints;
            
            if (totalPoints > 0) {
                document.getElementById('pointsText').textContent = 
                    `üéØ Keep earning points to unlock achievements!`;
            }
        }

        function getRecentActivityDays(results) {
            if (results.length === 0) return 0;
            
            const today = new Date();
            const recentResults = results.filter(result => {
                const resultDate = new Date(result.completedAt || result.createdAt);
                const daysDiff = Math.floor((today - resultDate) / (1000 * 60 * 60 * 24));
                return daysDiff <= 7; // Last 7 days
            });
            
            return Math.min(recentResults.length, 7);
        }

        function loadRecentActivity() {
            if (!dataIntegration) return;
            
            const studentProgress = dataIntegration.getStudentProgress()
                .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt))
                .slice(0, 5);
            
            const activityFeed = document.getElementById('activityFeed');
            
            if (studentProgress.length === 0) {
                activityFeed.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>No Recent Activity</h3>
                        <p>Start taking quizzes to see your activity here!</p>
                    </div>
                `;
                return;
            }

            activityFeed.innerHTML = studentProgress.map(result => {
                const quizTitle = result.quizTitle || 'Unknown Quiz';
                const className = result.className || 'Unknown Class';
                const score = result.score || 0;
                const date = new Date(result.completedAt);
                const timeAgo = getTimeAgo(date);
                
                let iconClass = 'primary';
                let icon = 'fas fa-clipboard-check';
                
                if (score >= 90) {
                    iconClass = 'success';
                    icon = 'fas fa-star';
                } else if (score >= 70) {
                    iconClass = 'accent';
                    icon = 'fas fa-thumbs-up';
                } else {
                    iconClass = 'warning';
                    icon = 'fas fa-redo';
                }
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${iconClass}">
                            <i class="${icon}"></i>
                        </div>
                        <div class="activity-content">
                            <h4>Completed: ${quizTitle}</h4>
                            <p>Score: ${score}% ‚Ä¢ ${getScoreMessage(score)}</p>
                        </div>
                        <div class="activity-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) {
                return `${diffMins}m ago`;
            } else if (diffHours < 24) {
                return `${diffHours}h ago`;
            } else {
                return `${diffDays}d ago`;
            }
        }

        function getScoreMessage(score) {
            if (score >= 90) return 'Excellent! üåü';
            if (score >= 80) return 'Great job! üëè';
            if (score >= 70) return 'Good work! üëç';
            if (score >= 60) return 'Keep trying! üí™';
            return 'Practice more! üìö';
        }

        function startQuiz(quizId) {
            const quiz = quizzes.find(q => q.id === quizId);
            if (!quiz) {
                showNotification('Quiz not found!', 'error');
                return;
            }
            
            // Store selected quiz for the interface
            localStorage.setItem('selectedQuiz', JSON.stringify(quiz));
            window.location.href = 'quiz-interface.html';
        }

        function findRandomQuiz() {
            const publishedQuizzes = quizzes.filter(quiz => quiz.status === 'published' && quiz.published === true);
            if (publishedQuizzes.length === 0) {
                showNotification('No quizzes available at the moment!', 'warning');
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * publishedQuizzes.length);
            const randomQuiz = publishedQuizzes[randomIndex];
            
            showNotification(`Starting random quiz: ${randomQuiz.title}`, 'success');
            setTimeout(() => {
                startQuiz(randomQuiz.id);
            }, 1000);
        }

        function viewProgress() {
            const userResults = quizResults.filter(result => result.studentEmail === currentUser.email);
            const publishedQuizzes = quizzes.filter(quiz => quiz.status === 'published' && quiz.published === true);
            
            if (userResults.length === 0) {
                showNotification('No progress to show yet. Start taking quizzes!', 'info');
                return;
            }
            
            const completedQuizIds = [...new Set(userResults.map(r => r.quizId))];
            const completedCount = completedQuizIds.length;
            const totalQuizzes = publishedQuizzes.length;
            const averageScore = userResults.reduce((sum, result) => sum + result.score, 0) / userResults.length;
            
            showNotification(`Progress: ${completedCount}/${totalQuizzes} quizzes completed with ${Math.round(averageScore)}% average score`, 'success');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success-500)' : 
                             type === 'error' ? 'var(--danger-500)' : 
                             type === 'warning' ? 'var(--warning-500)' : 'var(--primary-600)'};
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: var(--shadow-xl);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
                font-weight: 500;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                    type === 'error' ? 'exclamation-circle' : 
                                    type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 4000);
        }

        function refreshQuizzes() {
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            btn.disabled = true;
            
            setTimeout(() => {
                loadQuizzes();
                loadStatistics();
                loadRecentActivity();
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                showNotification('Data refreshed successfully!', 'success');
            }, 1000);
        }

        function viewQuizResults(quizId) {
            const quiz = quizzes.find(q => q.id === quizId);
            const userResults = quizResults.filter(result => 
                result.quizId === quizId && result.studentEmail === currentUser.email
            );
            
            if (userResults.length === 0) {
                showNotification('No results found for this quiz.', 'warning');
                return;
            }
            
            const bestScore = Math.max(...userResults.map(r => r.score));
            const latestResult = userResults.sort((a, b) => 
                new Date(b.completedAt || b.createdAt) - new Date(a.completedAt || a.createdAt)
            )[0];
            
            const message = `${quiz.title}: Best score ${bestScore}%, Latest score ${latestResult.score}% (${userResults.length} attempts)`;
            showNotification(message, 'info');
        }

        function refreshData() {
            loadQuizzes();
            loadStatistics();
            loadRecentActivity();
        }

        function createSampleQuizzes() {
            const sampleQuizzes = [
                {
                    id: 'sample-1',
                    title: 'Basic Computer Knowledge',
                    description: 'Test your understanding of basic computer concepts',
                    difficulty: 'Easy',
                    subject: 'Computer Science',
                    status: 'published',
                    published: true,
                    createdBy: 'demo@teacher.com',
                    createdAt: new Date().toISOString(),
                    questions: [
                        {
                            id: 'q1',
                            text: 'What does CPU stand for?',
                            options: ['Central Processing Unit', 'Computer Processing Unit', 'Central Program Unit', 'Computer Program Unit'],
                            correctAnswer: 0
                        },
                        {
                            id: 'q2',
                            text: 'Which of these is a programming language?',
                            options: ['HTML', 'CSS', 'JavaScript', 'All of the above'],
                            correctAnswer: 3
                        },
                        {
                            id: 'q3',
                            text: 'What is the main function of RAM?',
                            options: ['Store data permanently', 'Process data', 'Store data temporarily', 'Display data'],
                            correctAnswer: 2
                        }
                    ]
                },
                {
                    id: 'sample-2',
                    title: 'Mathematics Basics',
                    description: 'Fundamental math concepts and calculations',
                    difficulty: 'Medium',
                    subject: 'Mathematics',
                    status: 'published',
                    published: true,
                    createdBy: 'demo@teacher.com',
                    createdAt: new Date().toISOString(),
                    questions: [
                        {
                            id: 'q1',
                            text: 'What is 15 + 27?',
                            options: ['40', '41', '42', '43'],
                            correctAnswer: 2
                        },
                        {
                            id: 'q2',
                            text: 'What is the square root of 64?',
                            options: ['6', '7', '8', '9'],
                            correctAnswer: 2
                        },
                        {
                            id: 'q3',
                            text: 'What is 12 √ó 8?',
                            options: ['94', '95', '96', '97'],
                            correctAnswer: 2
                        }
                    ]
                },
                {
                    id: 'sample-3',
                    title: 'Science Quiz',
                    description: 'General science knowledge test',
                    difficulty: 'Easy',
                    subject: 'Science',
                    status: 'published',
                    published: true,
                    createdBy: 'demo@teacher.com',
                    createdAt: new Date().toISOString(),
                    questions: [
                        {
                            id: 'q1',
                            text: 'What is the chemical symbol for water?',
                            options: ['H2O', 'CO2', 'O2', 'NaCl'],
                            correctAnswer: 0
                        },
                        {
                            id: 'q2',
                            text: 'How many bones are in the human body?',
                            options: ['206', '207', '208', '209'],
                            correctAnswer: 0
                        },
                        {
                            id: 'q3',
                            text: 'What planet is closest to the sun?',
                            options: ['Venus', 'Earth', 'Mercury', 'Mars'],
                            correctAnswer: 2
                        }
                    ]
                }
            ];
            
            // Only add sample quizzes if there are no existing quizzes
            const existingQuizzes = JSON.parse(localStorage.getItem('gestureQuizzes') || '[]');
            if (existingQuizzes.length === 0) {
                localStorage.setItem('gestureQuizzes', JSON.stringify(sampleQuizzes));
                showNotification('Sample quizzes created successfully!', 'success');
                setTimeout(() => {
                    refreshData();
                }, 1000);
            }
        }

        function refreshData() {
            loadQuizzes();
            loadStatistics();
            loadRecentActivity();
        }

        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    // Firebase logout
                    if (typeof firebase !== 'undefined' && firebase.auth) {
                        await firebase.auth().signOut();
                    }
                    
                    // Clear local storage
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('gestureQuizUser');
                    localStorage.removeItem('rememberUser');
                    
                    // Redirect to main page
                    window.location.href = 'https://ahmadadeltub.github.io/gesturequiz-platform/index.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    // Force logout even if Firebase fails
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('gestureQuizUser');
                    localStorage.removeItem('rememberUser');
                    window.location.href = 'https://ahmadadeltub.github.io/gesturequiz-platform/index.html';
                }
            }
        }

        function setupRealTimeUpdates() {
            // Listen for data updates
            document.addEventListener('dataUpdate', function(event) {
                const { type, data } = event.detail;
                handleDataUpdate(type, data);
            });
            
            // Subscribe to real-time updates
            apiClient.subscribeToUpdates(handleRealTimeUpdate);
        }

        function handleDataUpdate(type, data) {
            switch(type) {
                case 'quizzes':
                    loadQuizzes();
                    loadStatistics();
                    break;
                case 'classes':
                    loadQuizzes();
                    loadStatistics();
                    break;
                case 'submissions':
                    loadStatistics();
                    loadRecentActivity();
                    break;
            }
        }

        function handleRealTimeUpdate(updates) {
            updates.forEach(update => {
                handleDataUpdate(update.type, update.data);
                showNotification(`New ${update.type} update received!`, 'info');
            });
        }

        // Auto-refresh when page becomes visible
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                refreshData();
            }
        });

        // Profile Modal Functions
        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            
            // Populate form with current user data
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('currentProfileAvatar').textContent = currentUser.avatar || 'üë®‚Äçüéì';
            
            // Clear previous selections
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.emoji === currentUser.avatar) {
                    option.classList.add('selected');
                }
            });
            
            modal.classList.add('show');
            modal.style.display = 'flex';
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
            document.getElementById('profileForm').reset();
        }

        // Initialize profile modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Handle emoji selection
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove previous selection
                    document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selection to clicked emoji
                    this.classList.add('selected');
                    
                    // Update current avatar display
                    const selectedEmoji = this.dataset.emoji;
                    document.getElementById('currentProfileAvatar').textContent = selectedEmoji;
                });
            });
            
            // Handle profile form submission
            document.getElementById('profileForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                try {
                    const formData = new FormData(e.target);
                    
                    // Get selected emoji
                    const selectedEmoji = document.querySelector('.emoji-option.selected');
                    const newAvatar = selectedEmoji ? selectedEmoji.dataset.emoji : 'üë®‚Äçüéì';
                    
                    const updatedData = {
                        name: formData.get('profileName'),
                        avatar: newAvatar
                    };
                    
                    // First check if Firebase is available
                    if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                        const authUser = firebase.auth().currentUser;
                        if (authUser) {
                            const result = await window.firebaseDataManager.updateUserProfile(authUser.uid, updatedData);
                            if (result.success) {
                                showNotification('Profile updated successfully!', 'success');
                                
                                // Update current user object
                                currentUser = { ...currentUser, ...updatedData };
                                
                                // Update UI immediately
                                updateProfileUI(currentUser);
                                
                                // Update localStorage for offline access
                                const localUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                                localStorage.setItem('currentUser', JSON.stringify({
                                    ...localUser,
                                    ...updatedData
                                }));
                                
                                // Close modal
                                closeProfileModal();
                                return;
                            } else {
                                throw new Error(result.error || 'Failed to update profile');
                            }
                        }
                    }
                    
                    // Fallback to localStorage
                    const localUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    const updatedUser = {
                        ...localUser,
                        ...updatedData
                    };
                    
                    localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                    currentUser = updatedUser;
                    
                    showNotification('Profile updated successfully!', 'success');
                    
                    // Update UI immediately
                    updateProfileUI(updatedUser);
                    
                    // Close modal
                    closeProfileModal();
                    
                } catch (error) {
                    console.error('Error updating profile:', error);
                    showNotification('Error updating profile: ' + error.message, 'error');
                }
            });

            // Close modal when clicking outside
            document.getElementById('profileModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeProfileModal();
                }
            });
        });

        function updateProfileUI(user) {
            // Update user name in header
            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
                userNameElement.textContent = user.name;
            }
            
            // Update avatar in header
            const userAvatar = document.getElementById('userAvatar');
            if (user.avatar) {
                userAvatar.textContent = user.avatar;
            } else {
                // Fallback to initials
                const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
                userAvatar.textContent = initials;
            }
        }
    </script>
</body>
</html>
