<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Management - GestureQuiz</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Modern Design System */
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-200: #bfdbfe;
            --primary-300: #93c5fd;
            --primary-400: #60a5fa;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-800: #1e40af;
            --primary-900: #1e3a8a;
            
            --secondary-50: #f8fafc;
            --secondary-100: #f1f5f9;
            --secondary-200: #e2e8f0;
            --secondary-300: #cbd5e1;
            --secondary-400: #94a3b8;
            --secondary-500: #64748b;
            --secondary-600: #475569;
            --secondary-700: #334155;
            --secondary-800: #1e293b;
            --secondary-900: #0f172a;
            
            /* Neutral colors (alias for secondary) */
            --neutral-0: #ffffff;
            --neutral-50: #f8fafc;
            --neutral-100: #f1f5f9;
            --neutral-200: #e2e8f0;
            --neutral-300: #cbd5e1;
            --neutral-400: #94a3b8;
            --neutral-500: #64748b;
            --neutral-600: #475569;
            --neutral-700: #334155;
            --neutral-800: #1e293b;
            --neutral-900: #0f172a;
            
            --accent-50: #fdf4ff;
            --accent-100: #fae8ff;
            --accent-200: #f5d0fe;
            --accent-300: #f0abfc;
            --accent-400: #e879f9;
            --accent-500: #d946ef;
            --accent-600: #c026d3;
            --accent-700: #a21caf;
            --accent-800: #86198f;
            --accent-900: #701a75;
            
            --success-50: #f0fdf4;
            --success-100: #dcfce7;
            --success-200: #bbf7d0;
            --success-300: #86efac;
            --success-400: #4ade80;
            --success-500: #22c55e;
            --success-600: #16a34a;
            --success-700: #15803d;
            --success-800: #166534;
            --success-900: #14532d;
            
            --warning-50: #fffbeb;
            --warning-100: #fef3c7;
            --warning-200: #fde68a;
            --warning-300: #fcd34d;
            --warning-400: #fbbf24;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --warning-700: #b45309;
            --warning-800: #92400e;
            --warning-900: #78350f;
            
            --danger-50: #fef2f2;
            --danger-100: #fee2e2;
            --danger-200: #fecaca;
            --danger-300: #fca5a5;
            --danger-400: #f87171;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            --danger-700: #b91c1c;
            --danger-800: #991b1b;
            --danger-900: #7f1d1d;
            
            /* Modern Spacing System */
            --space-0: 0;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            --space-32: 8rem;
            
            /* Modern Typography */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;
            
            /* Modern Borders & Radius */
            --border-width: 1px;
            --border-width-2: 2px;
            --border-width-4: 4px;
            
            --radius-none: 0;
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-3xl: 2rem;
            --radius-full: 9999px;
            
            /* Modern Shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            
            /* Modern Gradients */
            --gradient-primary: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-500), var(--secondary-600));
            --gradient-accent: linear-gradient(135deg, var(--accent-500), var(--accent-600));
            --gradient-success: linear-gradient(135deg, var(--success-500), var(--success-600));
            --gradient-warning: linear-gradient(135deg, var(--warning-500), var(--warning-600));
            --gradient-danger: linear-gradient(135deg, var(--danger-500), var(--danger-600));
            
            /* Modern Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Modern Glass Effects */
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.2);
            --backdrop-blur: blur(20px);
        }

        /* Modern Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        *::before,
        *::after {
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            line-height: var(--line-height-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: var(--text-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            color: var(--secondary-900);
            background: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Modern Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--secondary-900);
            margin-bottom: var(--space-4);
        }

        h1 { 
            font-size: var(--text-4xl); 
            font-weight: 800;
        }
        
        h2 { 
            font-size: var(--text-3xl); 
            font-weight: var(--font-weight-bold);
        }
        
        h3 { 
            font-size: var(--text-2xl); 
            font-weight: var(--font-weight-semibold);
        }
        
        h4 { 
            font-size: var(--text-xl); 
            font-weight: var(--font-weight-semibold);
        }
        
        h5 { 
            font-size: var(--text-lg); 
            font-weight: var(--font-weight-medium);
        }
        
        h6 { 
            font-size: var(--text-base); 
            font-weight: var(--font-weight-medium);
        }

        p {
            margin-bottom: var(--space-4);
            color: var(--secondary-700);
            line-height: var(--line-height-relaxed);
        }

        small {
            font-size: var(--text-sm);
            color: var(--secondary-600);
            line-height: var(--line-height-normal);
        }

        /* Enhanced link styling */
        a {
            color: var(--primary-600);
            text-decoration: none;
            transition: var(--transition-normal);
        }

        a:hover {
            color: var(--primary-700);
            text-decoration: underline;
        }

        /* Enhanced list styling */
        ul, ol {
            padding-left: var(--space-6);
            margin-bottom: var(--space-4);
        }

        li {
            margin-bottom: var(--space-1);
            color: var(--neutral-700);
            line-height: var(--line-height-relaxed);
        }

        /* Modern Header */
        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--neutral-200);
            padding: var(--space-4) 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-4);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--neutral-900);
            text-decoration: none;
            transition: var(--transition-colors);
        }

        .header-title:hover {
            color: var(--primary-600);
            text-decoration: none;
        }

        .header-title i {
            font-size: var(--text-xl);
            color: var(--primary-600);
            background: var(--primary-100);
            padding: var(--space-2);
            border-radius: var(--radius-lg);
            transition: var(--transition-all);
        }

        .header-title:hover i {
            transform: scale(1.1);
            background: var(--primary-200);
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            color: var(--neutral-700);
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: 500;
            font-size: var(--text-sm);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-100);
            opacity: 0;
            transition: var(--transition-normal);
        }

        .nav-link:hover::before {
            opacity: 1;
        }

        .nav-link:hover {
            color: var(--primary-700);
            text-decoration: none;
            transform: translateY(-1px);
        }

        .nav-link i {
            font-size: var(--text-sm);
            transition: var(--transition-normal);
        }

        .nav-link:hover i {
            transform: scale(1.1);
        }

        .nav-link span {
            position: relative;
            z-index: 1;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--neutral-900);
            text-decoration: none;
        }

        .logo-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
            border-radius: var(--radius-xl);
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--neutral-600);
            font-size: 0.95rem;
        }

        .breadcrumb a {
            color: var(--primary-600);
            text-decoration: none;
            transition: var(--transition-normal);
        }

        .breadcrumb a:hover {
            color: var(--primary-700);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: var(--space-12);
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            color: var(--neutral-900);
            margin-bottom: var(--space-4);
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 1.25rem;
            color: var(--neutral-600);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto var(--space-8);
        }

        .page-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-12);
        }

        .stat-card {
            background: white;
            padding: var(--space-8);
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--neutral-200);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-600);
            font-size: 1.5rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--neutral-900);
            display: block;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--neutral-600);
            font-weight: 500;
        }

        .stat-trend {
            font-size: 0.9rem;
            margin-top: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-1);
            color: var(--success-600);
        }

        /* Classes Section */
        .classes-section {
            background: white;
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--neutral-200);
            overflow: hidden;
        }

        .section-header {
            padding: var(--space-8);
            border-bottom: 1px solid var(--neutral-200);
            background: linear-gradient(135deg, var(--neutral-50), white);
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .section-description {
            color: var(--neutral-600);
            font-size: 1rem;
        }

        .classes-grid {
            padding: var(--space-8);
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--space-6);
        }

        .class-card {
            background: linear-gradient(135deg, var(--neutral-50), white);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .class-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-600);
        }

        .class-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
            opacity: 0;
            transition: var(--transition-normal);
        }

        .class-card:hover::before {
            opacity: 0.05;
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }

        .class-info h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--space-1);
        }

        .class-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .class-tag {
            padding: var(--space-1) var(--space-2);
            background: var(--primary-50);
            color: var(--primary-600);
            border-radius: var(--radius-md);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .class-description {
            color: var(--neutral-600);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: var(--space-5);
        }

        .class-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
            padding: var(--space-3);
            background: var(--neutral-50);
            border-radius: var(--radius-lg);
        }

        .class-stat {
            text-align: center;
        }

        .class-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neutral-900);
        }

        .class-stat-label {
            font-size: 0.8rem;
            color: var(--neutral-600);
            font-weight: 500;
        }

        .class-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
        }

        .class-actions .btn {
            flex: 1;
            text-align: center;
            justify-content: center;
            pointer-events: auto;
            z-index: 20;
        }

        .class-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-16);
            color: var(--neutral-600);
            background: linear-gradient(135deg, var(--neutral-50), var(--neutral-0));
            border-radius: var(--radius-2xl);
            border: 2px dashed var(--neutral-300);
        }

        .empty-state-icon {
            font-size: 4rem;
            color: var(--neutral-400);
            margin-bottom: var(--space-4);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .empty-state h3 {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--neutral-700);
            margin-bottom: var(--space-2);
        }

        .empty-state p {
            font-size: var(--text-base);
            margin-bottom: var(--space-6);
        }

        /* Modern Student Management */
        .student-management-options {
            margin-bottom: var(--space-6);
        }

        .student-option-tabs {
            display: flex;
            background: var(--neutral-100);
            border-radius: var(--radius-xl);
            padding: var(--space-1);
            margin-bottom: var(--space-8);
        }

        .student-option-tab {
            flex: 1;
            padding: var(--space-4) var(--space-6);
            border: none;
            background: none;
            color: var(--neutral-600);
            font-weight: 500;
            font-size: var(--text-sm);
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: var(--transition-all);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .student-option-tab.active {
            background: var(--neutral-0);
            color: var(--primary-600);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .student-option-tab:hover {
            color: var(--primary-600);
        }

        .student-section {
            animation: fadeIn 0.3s ease-in-out;
        }

        .add-option-tabs {
            display: flex;
            background: var(--neutral-100);
            border-radius: var(--radius-xl);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
        }

        .add-option-tab {
            flex: 1;
            padding: var(--space-3) var(--space-5);
            border: none;
            background: none;
            color: var(--neutral-600);
            font-weight: 500;
            font-size: var(--text-sm);
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: var(--transition-all);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .add-option-tab.active {
            background: var(--neutral-0);
            color: var(--primary-600);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .add-option-tab:hover {
            color: var(--primary-600);
        }

        .student-form {
            background: var(--neutral-50);
            padding: var(--space-8);
            border-radius: var(--radius-2xl);
            border: 1px solid var(--neutral-200);
            margin-bottom: var(--space-6);
        }

        .student-form h3 {
            margin-bottom: var(--space-6);
            color: var(--neutral-900);
            font-size: var(--text-xl);
            font-weight: 600;
        }

        /* Enhanced Student List */
        .student-list-container {
            background: var(--neutral-50);
            padding: var(--space-6);
            border-radius: var(--radius-2xl);
            border: 1px solid var(--neutral-200);
        }

        .student-search-container {
            margin-bottom: var(--space-6);
        }

        .student-search-container .form-input {
            width: 100%;
            padding-left: var(--space-12);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23a3a3a3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: var(--space-3) center;
            background-size: 20px 20px;
        }

        .student-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-6);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-xl);
            background: var(--neutral-0);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .student-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
            transform: scaleY(0);
            transition: var(--transition-normal);
        }

        .student-item:hover::before {
            transform: scaleY(1);
        }

        .student-item:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
            transform: translateX(8px);
            box-shadow: var(--shadow-lg);
        }

        .student-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .student-info h4 {
            margin: 0;
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--neutral-900);
        }

        .student-info p {
            margin: 0;
            font-size: var(--text-sm);
            color: var(--neutral-600);
        }

        .student-meta {
            display: flex;
            gap: var(--space-4);
            align-items: center;
            font-size: var(--text-xs);
            color: var(--neutral-500);
        }

        .student-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .student-meta-item i {
            font-size: var(--text-xs);
        }

        .student-actions {
            display: flex;
            gap: var(--space-2);
        }

        .student-count-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            background: var(--primary-100);
            color: var(--primary-700);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 600;
            margin-bottom: var(--space-4);
        }

        /* Enhanced Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-16);
            color: var(--neutral-600);
            background: linear-gradient(135deg, var(--neutral-50), var(--neutral-0));
            border-radius: var(--radius-2xl);
            border: 2px dashed var(--neutral-300);
        }

        .empty-state-icon {
            font-size: 4rem;
            color: var(--neutral-400);
            margin-bottom: var(--space-4);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .empty-state h3 {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--neutral-700);
            margin-bottom: var(--space-2);
        }

        .empty-state p {
            font-size: var(--text-base);
            margin-bottom: var(--space-6);
        }

        /* Bulk Input Methods */
        .bulk-input-methods {
            margin-top: var(--space-6);
        }

        .input-method-tabs {
            display: flex;
            background: var(--neutral-100);
            border-radius: var(--radius-xl);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
        }

        .method-tab {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: none;
            color: var(--neutral-600);
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: var(--transition-all);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
        }

        .method-tab.active {
            background: var(--neutral-0);
            color: var(--primary-600);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .method-tab:hover {
            color: var(--primary-600);
        }

        .input-method {
            background: var(--neutral-0);
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            border: 1px solid var(--neutral-200);
        }

        .input-help {
            margin-bottom: var(--space-6);
            padding: var(--space-4);
            background: var(--primary-50);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--primary-600);
        }

        .input-help p {
            margin: 0 0 var(--space-2) 0;
            font-size: var(--text-sm);
            color: var(--neutral-700);
            font-weight: 500;
        }

        .input-help small {
            color: var(--neutral-600);
            font-style: italic;
            line-height: var(--line-height-relaxed);
        }

        .bulk-actions {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-6);
        }

        /* Validation Results */
        .validation-results {
            margin-top: var(--space-6);
            padding: var(--space-6);
            background: var(--neutral-0);
            border-radius: var(--radius-xl);
            border: 1px solid var(--neutral-200);
        }

        .validation-results h4 {
            margin: 0 0 var(--space-4) 0;
            color: var(--neutral-900);
            font-size: var(--text-lg);
            font-weight: 600;
        }

        .validation-section {
            margin-bottom: var(--space-6);
        }

        .validation-section:last-child {
            margin-bottom: 0;
        }

        .validation-section h5 {
            margin: 0 0 var(--space-3) 0;
            font-size: var(--text-base);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .validation-section.success h5 {
            color: var(--success-700);
        }

        .validation-section.error h5 {
            color: var(--danger-700);
        }

        .student-preview {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .student-preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3);
            background: var(--neutral-50);
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
        }

        .student-preview-item.error {
            background: var(--danger-50);
            border-color: var(--danger-200);
        }

        .student-name {
            font-weight: 500;
            color: var(--neutral-900);
        }

        .student-email {
            color: var(--neutral-600);
            font-size: var(--text-sm);
        }

        .student-error {
            color: var(--danger-600);
            font-size: var(--text-sm);
            font-weight: 500;
        }

        /* File Upload Enhancement */
        .file-upload-area {
            border: 2px dashed var(--neutral-300);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            text-align: center;
            transition: var(--transition-all);
            cursor: pointer;
            background: var(--neutral-50);
        }

        .file-upload-area:hover {
            border-color: var(--primary-400);
            background: var(--primary-50);
        }

        .file-upload-area.dragover {
            border-color: var(--primary-600);
            background: var(--primary-100);
        }

        .file-upload-icon {
            font-size: 3rem;
            color: var(--neutral-400);
            margin-bottom: var(--space-4);
        }

        .file-upload-area:hover .file-upload-icon {
            color: var(--primary-500);
        }

        .file-upload-text {
            font-size: var(--text-base);
            color: var(--neutral-700);
            font-weight: 500;
            margin-bottom: var(--space-2);
        }

        .file-upload-subtext {
            font-size: var(--text-sm);
            color: var(--neutral-500);
        }

        /* Modern Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border: 2px solid transparent;
            border-radius: var(--radius-xl);
            font-size: var(--text-sm);
            font-weight: var(--font-weight-semibold);
            line-height: 1;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            user-select: none;
            white-space: nowrap;
            min-height: 44px;
            background: var(--neutral-0);
            color: var(--neutral-700);
            box-shadow: var(--shadow-sm);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            opacity: 0;
            transition: var(--transition-normal);
            z-index: -1;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:focus {
            outline: 2px solid var(--primary-600);
            outline-offset: 2px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary-600);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            border-color: var(--primary-700);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
            border-color: var(--secondary-600);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--secondary-600), var(--secondary-700));
            border-color: var(--secondary-700);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            border-color: var(--success-600);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, var(--success-600), var(--success-700));
            border-color: var(--success-700);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
            border-color: var(--warning-600);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, var(--warning-600), var(--warning-700));
            border-color: var(--warning-700);
            color: white;
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            border-color: var(--danger-600);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, var(--danger-600), var(--danger-700));
            border-color: var(--danger-700);
            color: white;
        }

        .btn-outline {
            background: var(--neutral-0);
            color: var(--neutral-700);
            border-color: var(--neutral-300);
        }

        .btn-outline:hover {
            background: var(--neutral-100);
            border-color: var(--neutral-400);
            color: var(--neutral-800);
        }

        .btn-outline-primary {
            background: var(--neutral-0);
            color: var(--primary-600);
            border-color: var(--primary-600);
        }

        .btn-outline-primary:hover {
            background: var(--primary-600);
            color: white;
        }

        .btn-small {
            padding: var(--space-2) var(--space-4);
            font-size: var(--text-xs);
            min-height: 36px;
        }

        .btn-large {
            padding: var(--space-4) var(--space-8);
            font-size: var(--text-base);
            min-height: 52px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        /* Modern Form System */
        .form-group {
            margin-bottom: var(--space-6);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-size: var(--text-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--neutral-800);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--neutral-300);
            border-radius: var(--radius-lg);
            font-size: var(--text-base);
            font-family: inherit;
            background: var(--neutral-0);
            color: var(--neutral-900);
            transition: var(--transition-normal);
            min-height: 44px;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-600);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input:hover,
        .form-textarea:hover,
        .form-select:hover {
            border-color: var(--neutral-400);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--neutral-500);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
        }

        .form-actions {
            display: flex;
            gap: var(--space-4);
            justify-content: flex-end;
            padding-top: var(--space-6);
            border-top: 1px solid var(--neutral-200);
            margin-top: var(--space-8);
        }

        /* Modern Modal System */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .modal-content {
            background: var(--neutral-0);
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-2xl);
            border: 1px solid var(--neutral-200);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideInUp 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-8) var(--space-8) var(--space-6) var(--space-8);
            border-bottom: 1px solid var(--neutral-200);
            background: linear-gradient(135deg, var(--neutral-50), var(--neutral-0));
            border-radius: var(--radius-3xl) var(--radius-3xl) 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: var(--text-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--neutral-900);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .modal-header h2 i {
            color: var(--primary-600);
            font-size: var(--text-xl);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: var(--text-xl);
            color: var(--neutral-500);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-lg);
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .close-btn:hover {
            color: var(--neutral-700);
            background: var(--neutral-100);
        }

        .modal-body {
            padding: var(--space-8);
        }

        .modal-tabs {
            display: flex;
            background: var(--neutral-100);
            border-radius: var(--radius-xl);
            padding: var(--space-1);
            margin-bottom: var(--space-8);
        }

        .modal-tab {
            flex: 1;
            padding: var(--space-4) var(--space-6);
            border: none;
            background: none;
            color: var(--neutral-600);
            font-weight: var(--font-weight-medium);
            font-size: var(--text-sm);
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .modal-tab.active {
            background: var(--neutral-0);
            color: var(--primary-600);
            font-weight: var(--font-weight-semibold);
            box-shadow: var(--shadow-sm);
        }

        .modal-tab:hover {
            color: var(--primary-600);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Modern Quick Actions */
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            margin-bottom: var(--space-8);
            flex-wrap: wrap;
        }

        .quick-action {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-5);
            background: var(--neutral-0);
            border: 2px solid var(--neutral-300);
            border-radius: var(--radius-xl);
            color: var(--neutral-700);
            text-decoration: none;
            font-weight: var(--font-weight-medium);
            font-size: var(--text-sm);
            transition: var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }

        .quick-action:hover {
            background: var(--primary-50);
            border-color: var(--primary-600);
            color: var(--primary-700);
            text-decoration: none;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .quick-action i {
            font-size: var(--text-base);
        }

        /* Modern Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--neutral-200);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: var(--space-4);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-500));
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }

        /* Modern Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neutral-800);
            color: var(--neutral-0);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--text-xs);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
            z-index: 1000;
        }

        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }

        /* Modern Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Modern Notification System */
        .notification {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            background: var(--neutral-0);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-xl);
            padding: var(--space-4) var(--space-6);
            box-shadow: var(--shadow-xl);
            z-index: 1100;
            animation: slideInDown 0.3s ease-out;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .notification.success {
            border-left: 4px solid var(--success-600);
            background: var(--success-50);
        }

        .notification.error {
            border-left: 4px solid var(--danger-600);
            background: var(--danger-50);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-600);
            background: var(--warning-50);
        }

        .notification.info {
            border-left: 4px solid var(--primary-600);
            background: var(--primary-50);
        }

        .notification-icon {
            font-size: var(--text-lg);
        }

        .notification.success .notification-icon {
            color: var(--success-600);
        }

        .notification.error .notification-icon {
            color: var(--danger-600);
        }

        .notification.warning .notification-icon {
            color: var(--warning-600);
        }

        .notification.info .notification-icon {
            color: var(--primary-600);
        }

        .notification-message {
            flex: 1;
            font-size: var(--text-sm);
            font-weight: var(--font-weight-medium);
            color: var(--neutral-800);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--neutral-500);
            cursor: pointer;
            font-size: var(--text-sm);
            padding: var(--space-1);
            border-radius: var(--radius-md);
            transition: var(--transition-normal);
        }

        .notification-close:hover {
            color: var(--neutral-700);
            background: var(--neutral-100);
        }

        /* ...existing code... */
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="teacher-dashboard.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                GestureQuiz
            </a>
            
            <div class="breadcrumb">
                <a href="teacher-dashboard.html">Dashboard</a>
                <i class="fas fa-chevron-right"></i>
                <span>Class Management</span>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Class Management</h1>
            <p class="page-subtitle">Create and manage your classes, organize students, and track progress all in one place</p>
            
            <div class="quick-actions">
                <a href="quiz-creator.html" class="quick-action">
                    <i class="fas fa-plus-circle"></i>
                    Create Quiz
                </a>
                <a href="quiz-management.html" class="quick-action">
                    <i class="fas fa-tasks"></i>
                    Manage Quizzes
                </a>
                <a href="analytics.html" class="quick-action">
                    <i class="fas fa-chart-line"></i>
                    View Analytics
                </a>
            </div>
            
            <div class="page-actions">
                <button class="btn btn-primary" onclick="openClassModal()">
                    <i class="fas fa-plus"></i>
                    Create New Class
                </button>
                <button class="btn btn-outline tooltip" data-tooltip="Get help with class management" onclick="showHelp()">
                    <i class="fas fa-question-circle"></i>
                    Help
                </button>
                <a href="teacher-dashboard.html" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="stat-number" id="totalClasses">0</div>
                <div class="stat-label">Total Classes</div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>Active classes</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                </div>
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label">Total Students</div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>Across all classes</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="stat-number" id="avgStudentsPerClass">0</div>
                <div class="stat-label">Avg Students/Class</div>
                <div class="stat-trend">
                    <i class="fas fa-equals"></i>
                    <span>Class size average</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                </div>
                <div class="stat-number" id="recentlyActive">0</div>
                <div class="stat-label">Recently Active</div>
                <div class="stat-trend">
                    <i class="fas fa-clock"></i>
                    <span>This week</span>
                </div>
            </div>
        </div>

        <div class="classes-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    Your Classes
                </h2>
                <p class="section-description">Manage your classes, students, and educational content</p>
                
                <div style="margin-top: var(--space-4);">
                    <div style="display: flex; gap: var(--space-3); align-items: center; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <input type="text" id="searchClasses" placeholder="Search classes..." 
                                   class="form-input" style="margin: 0;" 
                                   onkeyup="filterClasses()" />
                        </div>
                        <select id="filterSubject" class="form-input" style="margin: 0; width: auto;" 
                                onchange="filterClasses()">
                            <option value="">All Subjects</option>
                            <option value="computer-science">Computer Science</option>
                            <option value="mathematics">Mathematics</option>
                            <option value="physics">Physics</option>
                            <option value="chemistry">Chemistry</option>
                            <option value="biology">Biology</option>
                            <option value="history">History</option>
                            <option value="english">English</option>
                            <option value="art">Art</option>
                            <option value="music">Music</option>
                            <option value="physical-education">Physical Education</option>
                            <option value="other">Other</option>
                        </select>
                        <button class="btn btn-outline btn-small" onclick="clearFilters()">
                            <i class="fas fa-times"></i>
                            Clear
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="classes-grid" id="classesGrid">
                <!-- Classes will be populated here -->
            </div>
        </div>
    </main>

    <!-- Class Modal -->
    <div id="classModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">
                    <i class="fas fa-plus"></i>
                    Create New Class
                </h2>
                <button class="close-btn" onclick="closeClassModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchTab('classInfo')">
                        <i class="fas fa-info-circle"></i>
                        Class Information
                    </button>
                    <button class="modal-tab" onclick="switchTab('students')" id="studentsTab" style="display: none;">
                        <i class="fas fa-user-graduate"></i>
                        Students
                    </button>
                </div>

                <!-- Class Information Tab -->
                <div id="classInfoTabContent" class="tab-content active">
                    <form id="classForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="className">Class Name *</label>
                                <input type="text" id="className" name="className" class="form-input" required 
                                       placeholder="e.g., Computer Science 101">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="classSubject">Subject *</label>
                                <select id="classSubject" name="classSubject" class="form-input" required>
                                    <option value="">Select Subject</option>
                                    <option value="computer-science">Computer Science</option>
                                    <option value="mathematics">Mathematics</option>
                                    <option value="physics">Physics</option>
                                    <option value="chemistry">Chemistry</option>
                                    <option value="biology">Biology</option>
                                    <option value="history">History</option>
                                    <option value="english">English</option>
                                    <option value="art">Art</option>
                                    <option value="music">Music</option>
                                    <option value="physical-education">Physical Education</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="classGrade">Grade Level</label>
                                <select id="classGrade" name="classGrade" class="form-input">
                                    <option value="">Select Grade</option>
                                    <option value="k">Kindergarten</option>
                                    <option value="1">1st Grade</option>
                                    <option value="2">2nd Grade</option>
                                    <option value="3">3rd Grade</option>
                                    <option value="4">4th Grade</option>
                                    <option value="5">5th Grade</option>
                                    <option value="6">6th Grade</option>
                                    <option value="7">7th Grade</option>
                                    <option value="8">8th Grade</option>
                                    <option value="9">9th Grade</option>
                                    <option value="10">10th Grade</option>
                                    <option value="11">11th Grade</option>
                                    <option value="12">12th Grade</option>
                                    <option value="college">College</option>
                                    <option value="university">University</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="classRoom">Room/Location</label>
                                <input type="text" id="classRoom" name="classRoom" class="form-input" 
                                       placeholder="e.g., Room 101, Online">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="classDescription">Description</label>
                            <textarea id="classDescription" name="classDescription" class="form-input" rows="4" 
                                      placeholder="Brief description of the class, objectives, or notes..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="closeClassModal()">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <i class="fas fa-plus"></i>
                                Create Class
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Students Tab -->
                <div id="studentsTabContent" class="tab-content">
                    <!-- Student Management Options -->
                    <div class="student-management-options">
                        <div class="student-option-tabs">
                            <button class="student-option-tab active" onclick="switchStudentOption('add')">
                                <i class="fas fa-user-plus"></i>
                                Add Students
                            </button>
                            <button class="student-option-tab" onclick="switchStudentOption('view')">
                                <i class="fas fa-list"></i>
                                View Students
                            </button>
                        </div>
                        
                        <!-- Add Students Section -->
                        <div id="addStudentsSection" class="student-section">
                            <div class="add-option-tabs">
                                <button class="add-option-tab active" onclick="switchAddOption('single')">
                                    <i class="fas fa-user-plus"></i>
                                    Add Single Student
                                </button>
                                <button class="add-option-tab" onclick="switchAddOption('bulk')">
                                    <i class="fas fa-users"></i>
                                    Add Multiple Students
                                </button>
                            </div>
                        
                        <!-- Single Student Form -->
                        <div id="singleStudentForm" class="student-form">
                            <div id="studentFormHelp" class="help-text" style="margin-bottom: var(--space-4); padding: var(--space-3); background: var(--primary-50); border-radius: var(--radius-md); border-left: 4px solid var(--primary-500);">
                                <i class="fas fa-info-circle" style="color: var(--primary-500); margin-right: var(--space-2);"></i>
                                <span id="studentFormHelpText">Save the class first to enable adding students.</span>
                            </div>
                            <h3 style="margin-bottom: var(--space-4); color: var(--neutral-800);">
                                <i class="fas fa-user-plus"></i>
                                Add Individual Student
                            </h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="studentName">Student Name *</label>
                                    <input type="text" id="studentName" class="form-input" required 
                                           placeholder="Enter student's full name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="studentEmail">Student Email *</label>
                                    <input type="email" id="studentEmail" class="form-input" required 
                                           placeholder="Enter student's email address">
                                </div>
                            </div>
                            <button type="button" id="addStudentBtn" class="btn btn-success" onclick="addStudent()">
                                <i class="fas fa-user-plus"></i>
                                Add Student
                            </button>
                        </div>
                        
                        <!-- Bulk Student Form -->
                        <div id="bulkStudentForm" class="student-form" style="display: none;">
                            <h3 style="margin-bottom: var(--space-4); color: var(--neutral-800);">
                                <i class="fas fa-users"></i>
                                Add Multiple Students at Once
                            </h3>
                            
                            <div class="bulk-input-methods">
                                <div class="input-method-tabs">
                                    <button class="method-tab active" onclick="switchInputMethod('textarea')">
                                        <i class="fas fa-edit"></i>
                                        Type/Paste List
                                    </button>
                                    <button class="method-tab" onclick="switchInputMethod('csv')">
                                        <i class="fas fa-file-csv"></i>
                                        Upload CSV
                                    </button>
                                </div>
                                
                                <!-- Textarea Method -->
                                <div id="textareaMethod" class="input-method">
                                    <div class="form-group">
                                        <label class="form-label" for="bulkStudentText">Student List</label>
                                        <div class="input-help">
                                            <p>Enter students one per line in format: <strong>Name, Email</strong></p>
                                            <p><small>Example: John Doe, john.doe@email.com</small></p>
                                        </div>
                                        <textarea id="bulkStudentText" class="form-input" rows="6" 
                                                  placeholder="John Doe, john.doe@email.com&#10;Jane Smith, jane.smith@email.com&#10;Mike Johnson, mike.johnson@email.com"></textarea>
                                    </div>
                                    <div class="bulk-actions">
                                        <button type="button" class="btn btn-outline" onclick="generateSampleTemplate()">
                                            <i class="fas fa-file-download"></i>
                                            Generate Sample
                                        </button>
                                        <button type="button" class="btn btn-outline" onclick="validateBulkStudents()">
                                            <i class="fas fa-check-circle"></i>
                                            Validate List
                                        </button>
                                        <button type="button" class="btn btn-success" onclick="addBulkStudents()">
                                            <i class="fas fa-users"></i>
                                            Add All Students
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- CSV Method -->
                                <div id="csvMethod" class="input-method" style="display: none;">
                                    <div class="form-group">
                                        <label class="form-label" for="csvFile">Upload CSV File</label>
                                        <div class="input-help">
                                            <p>Upload a CSV file with columns: <strong>Name, Email</strong></p>
                                            <small>First row can contain headers or data. Maximum file size: 5MB</small>
                                        </div>
                                        <div class="file-upload-area" onclick="document.getElementById('csvFile').click()">
                                            <div class="file-upload-icon">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                            </div>
                                            <div class="file-upload-text">Drop CSV file here or click to upload</div>
                                            <div class="file-upload-subtext">Supports .csv and .txt files</div>
                                        </div>
                                        <input type="file" id="csvFile" accept=".csv,.txt" style="display: none;" onchange="handleCSVUpload(event)">
                                        <div style="margin-top: var(--space-4);">
                                            <button type="button" class="btn btn-outline btn-small" onclick="downloadCSVTemplate()">
                                                <i class="fas fa-download"></i>
                                                Download Template
                                            </button>
                                        </div>
                                    </div>
                                    <div id="csvPreview" class="csv-preview" style="display: none;">
                                        <h4><i class="fas fa-eye"></i> File Preview</h4>
                                        <div id="csvPreviewContent"></div>
                                        <div class="bulk-actions">
                                            <button type="button" class="btn btn-success" onclick="addCSVStudents()">
                                                <i class="fas fa-upload"></i>
                                                Import Students
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="bulkValidationResults" class="validation-results" style="display: none;">
                                <!-- Validation results will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- View Students Section -->
                    <div id="viewStudentsSection" class="student-section" style="display: none;">
                        <div class="student-list-container">
                            <div class="student-count-badge">
                                <i class="fas fa-users"></i>
                                <span id="currentStudentCount">0</span> Students
                            </div>
                            
                            <div class="student-search-container">
                                <input type="text" id="studentSearch" class="form-input" 
                                       placeholder="Search students by name or email..."
                                       onkeyup="filterStudents()" />
                            </div>
                            
                            <div id="studentList" class="student-list">
                                <!-- Students will be populated here -->
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="../js/firebase-config.js?v=20250709-classmanagement"></script>
    
    <!-- Data Managers -->
    <script src="../js/firebase-data-manager.js?v=20250709-classmanagement"></script>
    
    <script src="../js/live-data-manager.js"></script>
    <script src="../js/api-simulator.js"></script>
    <script src="../js/notification-system.js"></script>
    <script>
        let currentEditingClassId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Class Management page loading...');
            
            // Wait for Firebase to initialize before loading classes
            function initializePage() {
                loadUserData();
                loadClasses();
                updateStats();
                
                // For testing: create a test class if none exist
                createTestClassIfNeeded();
                
                // Add form submission handler
                document.getElementById('classForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveClass();
                });
            }
            
            // Check if Firebase is available
            if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                console.log('✅ Firebase already initialized');
                initializePage();
                showLoginReminder();
            } else {
                console.log('⏳ Waiting for Firebase to initialize...');
                // Wait a bit for Firebase to load
                setTimeout(() => {
                    if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                        console.log('✅ Firebase initialization complete');
                    } else {
                        console.warn('⚠️ Firebase not initialized - using localStorage only');
                    }
                    initializePage();
                    showLoginReminder();
                }, 2000);
            }
        });

        function createTestClassIfNeeded() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const teacherClasses = classes.filter(cls => cls.createdBy === currentUser.email);
            
            if (teacherClasses.length === 0 && currentUser.email) {
                const testClass = {
                    id: 'class_test_' + Date.now(),
                    name: 'Test Computer Science Class',
                    description: 'A test class for demonstrating the class management features',
                    subject: 'computer-science',
                    grade: '10',
                    room: 'Room 101',
                    createdBy: currentUser.email,
                    createdAt: new Date().toISOString(),
                    students: [
                        {
                            id: 'student_1',
                            name: 'John Doe',
                            email: 'john.doe@student.com',
                            addedAt: new Date().toISOString()
                        },
                        {
                            id: 'student_2',
                            name: 'Jane Smith',
                            email: 'jane.smith@student.com',
                            addedAt: new Date().toISOString()
                        }
                    ]
                };
                
                classes.push(testClass);
                localStorage.setItem('teacherClasses', JSON.stringify(classes));
                
                // Reload the page to show the test class
                setTimeout(() => {
                    loadClasses();
                    updateStats();
                }, 100);
            }
        }

        function loadUserData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (!currentUser.email) {
                window.location.href = '../index.html';
            }
        }

        async function loadClasses() {
            try {
                console.log('🔄 Loading classes...');
                const classesGrid = document.getElementById('classesGrid');
                
                // Check if Firebase is available and user is authenticated
                if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                    const currentUser = window.firebaseDataManager.getCurrentUser();
                    if (currentUser) {
                        console.log('✅ Using Firebase to load classes for user:', currentUser.email);
                        const classesResult = await window.firebaseDataManager.getClasses(currentUser.uid);
                        
                        if (classesResult.success) {
                            const classes = classesResult.data;
                            console.log(`📚 Loaded ${classes.length} classes from Firebase`);
                            displayClasses(classes);
                            
                            // Update localStorage to match Firebase (for offline usage)
                            localStorage.setItem('teacherClasses', JSON.stringify(classes));
                            return;
                        } else {
                            console.error('❌ Failed to load classes from Firebase:', classesResult.error);
                        }
                    } else {
                        console.warn('⚠️ No authenticated user found');
                    }
                } else {
                    console.warn('⚠️ Firebase not available or not initialized');
                }
                
                // Fallback to localStorage
                console.log('📦 Falling back to localStorage');
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
                const teacherClasses = classes.filter(cls => cls.createdBy === currentUser.email || cls.createdBy === currentUser.uid);
                console.log(`📚 Loaded ${teacherClasses.length} classes from localStorage`);
                displayClasses(teacherClasses);
                
            } catch (error) {
                console.error('❌ Error loading classes:', error);
                const classesGrid = document.getElementById('classesGrid');
                classesGrid.innerHTML = '<div class="empty-state"><h3>Error loading classes</h3><p>Please try again later.</p></div>';
            }
        }

        function displayClasses(classes) {
            const classesGrid = document.getElementById('classesGrid');
            
            if (classes.length === 0) {
                classesGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>No Classes Yet</h3>
                        <p>Create your first class to start organizing your students and managing quizzes.</p>
                        <button class="btn btn-primary" onclick="openClassModal()">
                            <i class="fas fa-plus"></i>
                            Create Your First Class
                        </button>
                    </div>
                `;
                return;
            }
            
            classesGrid.innerHTML = '';
            
            classes.forEach(cls => {
                const studentCount = cls.students ? cls.students.length : 0;
                const subjectDisplay = cls.subject ? cls.subject.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()) : 'General';
                const gradeDisplay = cls.grade ? (cls.grade === 'k' ? 'Kindergarten' : `Grade ${cls.grade}`) : '';
                
                const classCard = document.createElement('div');
                classCard.className = 'class-card';
                classCard.innerHTML = `
                    <div class="class-header">
                        <div class="class-info">
                            <h3>${cls.name}</h3>
                            <div class="class-meta">
                                <span class="class-tag">
                                    <i class="fas fa-book"></i>
                                    ${subjectDisplay}
                                </span>
                                ${gradeDisplay ? `<span class="class-tag">
                                    <i class="fas fa-graduation-cap"></i>
                                    ${gradeDisplay}
                                </span>` : ''}
                                ${cls.room ? `<span class="class-tag">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${cls.room}
                                </span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="class-description">
                        ${cls.description || 'No description provided.'}
                    </div>
                    
                    <div class="class-stats">
                        <div class="class-stat">
                            <div class="class-stat-number">${studentCount}</div>
                            <div class="class-stat-label">Students</div>
                        </div>
                        <div class="class-stat">
                            <div class="class-stat-number">0</div>
                            <div class="class-stat-label">Quizzes</div>
                        </div>
                        <div class="class-stat">
                            <div class="class-stat-number">--</div>
                            <div class="class-stat-label">Avg Score</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(studentCount * 10, 100)}%"></div>
                    </div>
                    
                    <div class="class-actions">
                        <button class="btn btn-outline btn-small" data-action="edit" data-class-id="${cls.id}">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn btn-success btn-small" data-action="students" data-class-id="${cls.id}">
                            <i class="fas fa-users"></i>
                            Students (${studentCount})
                        </button>
                        <button class="btn btn-danger btn-small" data-action="delete" data-class-id="${cls.id}">
                            <i class="fas fa-trash"></i>
                            Delete
                        </button>
                    </div>
                `;
                classesGrid.appendChild(classCard);
                
                // Add event listeners for the action buttons
                const actionButtons = classCard.querySelectorAll('[data-action]');
                actionButtons.forEach(button => {
                    button.addEventListener('click', function(event) {
                        event.stopPropagation();
                        const action = this.getAttribute('data-action');
                        const classId = this.getAttribute('data-class-id');
                        
                        switch(action) {
                            case 'edit':
                                editClass(classId);
                                break;
                            case 'students':
                                manageStudents(classId);
                                break;
                            case 'delete':
                                deleteClass(classId);
                                break;
                        }
                    });
                });
            });
        }

        function updateStats() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const teacherClasses = classes.filter(cls => cls.createdBy === currentUser.email);
            
            const totalClasses = teacherClasses.length;
            const totalStudents = teacherClasses.reduce((sum, cls) => sum + (cls.students ? cls.students.length : 0), 0);
            const avgStudentsPerClass = totalClasses > 0 ? Math.round(totalStudents / totalClasses * 10) / 10 : 0;
            
            // Animate counter updates
            animateCounter('totalClasses', totalClasses);
            animateCounter('totalStudents', totalStudents);
            animateCounter('avgStudentsPerClass', avgStudentsPerClass);
            animateCounter('recentlyActive', totalClasses); // Simplified for demo
        }

        function animateCounter(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const startValue = parseInt(element.textContent) || 0;
            const duration = 1000;
            const startTime = Date.now();
            
            const animate = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                
                const currentValue = startValue + (targetValue - startValue) * easeOut;
                element.textContent = elementId === 'avgStudentsPerClass' ? 
                    Math.round(currentValue * 10) / 10 : 
                    Math.round(currentValue);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            };
            
            animate();
        }

        // Class Action Functions
        function editClass(classId) {
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classToEdit = classes.find(cls => cls.id === classId);
            
            if (!classToEdit) {
                showNotification('Class not found!', 'error');
                return;
            }
            
            // Set editing mode
            currentEditingClassId = classId;
            
            // Update modal title and button
            const modalTitle = document.getElementById('modalTitle');
            const submitBtn = document.getElementById('submitBtn');
            const studentsTab = document.getElementById('studentsTab');
            
            modalTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Class';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
            studentsTab.style.display = 'block';
            
            // Update button state
            updateAddStudentButton();
            
            // Populate form with class data
            document.getElementById('className').value = classToEdit.name || '';
            document.getElementById('classSubject').value = classToEdit.subject || '';
            document.getElementById('classGrade').value = classToEdit.grade || '';
            document.getElementById('classRoom').value = classToEdit.room || '';
            document.getElementById('classDescription').value = classToEdit.description || '';
            
            // Show modal
            const modal = document.getElementById('classModal');
            modal.classList.add('active');
            modal.style.display = 'flex';
            
            // Switch to class info tab
            switchTab('classInfo');
        }

        async function deleteClass(classId) {
            try {
                console.log('🗑️ Starting class deletion process for ID:', classId);
                
                // Get class info first
                let classToDelete = null;
                
                // Try to get class from Firebase first
                if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                    const currentUser = window.firebaseDataManager.getCurrentUser();
                    if (currentUser) {
                        const classResult = await window.firebaseDataManager.getClass(classId);
                        if (classResult.success) {
                            classToDelete = classResult.data;
                        }
                    }
                }
                
                // Fallback to localStorage
                if (!classToDelete) {
                    const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
                    classToDelete = classes.find(cls => cls.id === classId);
                }
                
                if (!classToDelete) {
                    showNotification('Class not found!', 'error');
                    return;
                }
                
                const studentCount = classToDelete.students ? classToDelete.students.length : 0;
                const confirmMessage = studentCount > 0 
                    ? `Are you sure you want to delete "${classToDelete.name}"? This will remove ${studentCount} student(s) from the class.`
                    : `Are you sure you want to delete "${classToDelete.name}"?`;
                
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                // Delete from Firebase if available and user is authenticated
                if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                    const currentUser = window.firebaseDataManager.getCurrentUser();
                    if (currentUser) {
                        console.log('✅ User authenticated, deleting from Firebase...');
                        const result = await window.firebaseDataManager.deleteClass(classId);
                        
                        if (result.success) {
                            console.log('✅ Class deleted from Firebase successfully');
                            
                            // ALSO remove from localStorage to prevent reappearing
                            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
                            const updatedClasses = classes.filter(cls => cls.id !== classId);
                            localStorage.setItem('teacherClasses', JSON.stringify(updatedClasses));
                            console.log('✅ Class also removed from localStorage');
                            
                            showNotification('Class deleted successfully!', 'success');
                            loadClasses();
                            updateStats();
                            return;
                        } else {
                            throw new Error(result.error || 'Failed to delete class from Firebase');
                        }
                    } else {
                        console.warn('⚠️ No authenticated user - cannot delete from Firebase');
                        showNotification('Please log in to delete classes permanently.', 'warning');
                    }
                } else {
                    console.warn('⚠️ Firebase not available - using localStorage only');
                }
                
                // Fallback to localStorage only (not permanent)
                console.log('📦 Deleting from localStorage only (not permanent)');
                const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
                const updatedClasses = classes.filter(cls => cls.id !== classId);
                localStorage.setItem('teacherClasses', JSON.stringify(updatedClasses));
                
                showNotification('Class deleted (localStorage only). For permanent deletion, please log in.', 'warning');
                loadClasses();
                updateStats();
                
            } catch (error) {
                console.error('❌ Error deleting class:', error);
                showNotification('Error deleting class: ' + error.message, 'error');
            }
        }

        function manageStudents(classId) {
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classToManage = classes.find(cls => cls.id === classId);
            
            if (!classToManage) {
                showNotification('Class not found!', 'error');
                return;
            }
            
            // Set editing mode
            currentEditingClassId = classId;
            
            // Update modal title and show students tab
            const modalTitle = document.getElementById('modalTitle');
            const studentsTab = document.getElementById('studentsTab');
            
            modalTitle.innerHTML = `<i class="fas fa-users"></i> Manage Students - ${classToManage.name}`;
            studentsTab.style.display = 'block';
            
            // Show modal
            const modal = document.getElementById('classModal');
            modal.classList.add('active');
            modal.style.display = 'flex';
            
            // Switch to students tab
            switchTab('students');
            
            // Load students for viewing
            loadStudentsForView(classId);
        }

        function loadStudentsForView(classId) {
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classData = classes.find(cls => cls.id === classId);
            
            if (!classData) return;
            
            const studentList = document.getElementById('studentList');
            const studentCount = document.getElementById('currentStudentCount');
            
            const students = classData.students || [];
            studentCount.textContent = students.length;
            
            if (students.length === 0) {
                studentList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <h3>No Students Yet</h3>
                        <p>Add students to this class to get started.</p>
                    </div>
                `;
                return;
            }
            
            studentList.innerHTML = '';
            
            students.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <div class="student-info">
                        <h4>${student.name}</h4>
                        <p>${student.email}</p>
                        <div class="student-meta">
                            <div class="student-meta-item">
                                <i class="fas fa-calendar"></i>
                                <span>Added ${new Date(student.addedAt).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                    <div class="student-actions">
                        <button class="btn btn-outline btn-small" onclick="editStudent('${classId}', '${student.id}')">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn btn-danger btn-small" onclick="removeStudent('${classId}', '${student.id}')">
                            <i class="fas fa-trash"></i>
                            Remove
                        </button>
                    </div>
                `;
                studentList.appendChild(studentItem);
            });
        }

        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const studentItems = document.querySelectorAll('.student-item');
            
            studentItems.forEach(item => {
                const studentName = item.querySelector('h4').textContent.toLowerCase();
                const studentEmail = item.querySelector('p').textContent.toLowerCase();
                
                if (studentName.includes(searchTerm) || studentEmail.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function editStudent(classId, studentId) {
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classData = classes.find(cls => cls.id === classId);
            
            if (!classData) {
                showNotification('Class not found!', 'error');
                return;
            }
            
            const student = classData.students.find(s => s.id === studentId);
            if (!student) {
                showNotification('Student not found!', 'error');
                return;
            }
            
            const newName = prompt('Enter new name:', student.name);
            if (newName === null) return; // User cancelled
            
            const newEmail = prompt('Enter new email:', student.email);
            if (newEmail === null) return; // User cancelled
            
            if (!newName.trim() || !newEmail.trim()) {
                showNotification('Name and email cannot be empty!', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(newEmail)) {
                showNotification('Please enter a valid email address!', 'error');
                return;
            }
            
            // Check for duplicate email
            const existingStudent = classData.students.find(s => s.id !== studentId && s.email.toLowerCase() === newEmail.toLowerCase());
            if (existingStudent) {
                showNotification('A student with this email already exists!', 'error');
                return;
            }
            
            // Update student
            const classIndex = classes.findIndex(cls => cls.id === classId);
            const studentIndex = classes[classIndex].students.findIndex(s => s.id === studentId);
            
            classes[classIndex].students[studentIndex] = {
                ...student,
                name: newName.trim(),
                email: newEmail.trim(),
                updatedAt: new Date().toISOString()
            };
            
            localStorage.setItem('teacherClasses', JSON.stringify(classes));
            
            // Reload view
            loadStudentsForView(classId);
            loadClasses();
            updateStats();
            
            showNotification('Student updated successfully!', 'success');
        }

        function saveClass() {
            const className = document.getElementById('className').value.trim();
            const classSubject = document.getElementById('classSubject').value;
            const classGrade = document.getElementById('classGrade').value;
            const classRoom = document.getElementById('classRoom').value.trim();
            const classDescription = document.getElementById('classDescription').value.trim();
            
            if (!className || !classSubject) {
                showNotification('Please fill in required fields (Class Name and Subject).', 'error');
                return;
            }
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            
            if (currentEditingClassId) {
                // Edit existing class
                const classIndex = classes.findIndex(cls => cls.id === currentEditingClassId);
                if (classIndex === -1) {
                    showNotification('Class not found!', 'error');
                    return;
                }
                
                // Update class data
                classes[classIndex] = {
                    ...classes[classIndex],
                    name: className,
                    subject: classSubject,
                    grade: classGrade,
                    room: classRoom,
                    description: classDescription,
                    updatedAt: new Date().toISOString()
                };
                
                localStorage.setItem('teacherClasses', JSON.stringify(classes));
                showNotification('Class updated successfully!', 'success');
            } else {
                // Create new class
                const newClass = {
                    id: 'class_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                    name: className,
                    subject: classSubject,
                    grade: classGrade,
                    room: classRoom,
                    description: classDescription,
                    createdBy: currentUser.email,
                    createdAt: new Date().toISOString(),
                    students: []
                };
                
                classes.push(newClass);
                localStorage.setItem('teacherClasses', JSON.stringify(classes));
                
                // Set as currently editing for adding students
                currentEditingClassId = newClass.id;
                
                // Show students tab
                document.getElementById('studentsTab').style.display = 'block';
                
                // Update modal title and button to edit mode
                const modalTitle = document.getElementById('modalTitle');
                const submitBtn = document.getElementById('submitBtn');
                modalTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Class';
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                
                // Automatically switch to students tab
                setTimeout(() => {
                    switchTab('students');
                    updateAddStudentButton();
                }, 500);
                
                showNotification('Class created successfully! You can now add students.', 'success');
            }
            
            // Refresh the display
            loadClasses();
            updateStats();
        }

        function addStudent() {
            console.log('addStudent called'); // Debug log
            
            // Check if button is disabled
            const addStudentBtn = document.getElementById('addStudentBtn');
            if (addStudentBtn && addStudentBtn.disabled) {
                showNotification('Please save the class first before adding students.', 'warning');
                return;
            }
            
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            
            console.log('Student data:', { studentName, studentEmail, currentEditingClassId }); // Debug log
            
            if (!studentName || !studentEmail) {
                showNotification('Please enter both student name and email.', 'error');
                return;
            }
            
            if (!currentEditingClassId) {
                showNotification('Please save the class first before adding students.', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(studentEmail)) {
                showNotification('Please enter a valid email address.', 'error');
                return;
            }
            
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classIndex = classes.findIndex(cls => cls.id === currentEditingClassId);
            
            if (classIndex === -1) {
                showNotification('Class not found!', 'error');
                return;
            }
            
            // Initialize students array if it doesn't exist
            if (!classes[classIndex].students) {
                classes[classIndex].students = [];
            }
            
            // Check if student already exists
            if (classes[classIndex].students.some(s => s.email.toLowerCase() === studentEmail.toLowerCase())) {
                showNotification('A student with this email already exists in the class.', 'error');
                return;
            }
            
            // Add student
            const newStudent = {
                id: 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                name: studentName,
                email: studentEmail,
                addedAt: new Date().toISOString()
            };
            
            classes[classIndex].students.push(newStudent);
            localStorage.setItem('teacherClasses', JSON.stringify(classes));
            
            // Clear form
            document.getElementById('studentName').value = '';
            document.getElementById('studentEmail').value = '';
            
            // Update displays
            loadClasses();
            updateStats();
            
            // If we're in view mode, refresh the view
            const viewSection = document.getElementById('viewStudentsSection');
            if (viewSection && viewSection.style.display !== 'none') {
                loadStudentsForView(currentEditingClassId);
            }
            
            showNotification('Student added successfully!', 'success');
        }

        function removeStudent(classId, studentId) {
            if (!confirm('Are you sure you want to remove this student from the class?')) {
                return;
            }
            
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classIndex = classes.findIndex(cls => cls.id === classId);
            
            if (classIndex === -1) {
                showNotification('Class not found!', 'error');
                return;
            }
            
            // Remove student
            classes[classIndex].students = classes[classIndex].students.filter(s => s.id !== studentId);
            localStorage.setItem('teacherClasses', JSON.stringify(classes));
            
            // Update displays
            loadClasses();
            updateStats();
            
            // Refresh the view if we're in view mode
            const viewSection = document.getElementById('viewStudentsSection');
            if (viewSection && viewSection.style.display !== 'none') {
                loadStudentsForView(classId);
            }
            
            showNotification('Student removed successfully!', 'success');
        }

        // Check authentication status
        function checkAuthStatus() {
            try {
                if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                    const currentUser = window.firebaseDataManager.getCurrentUser();
                    if (currentUser) {
                        console.log('✅ Firebase authenticated as:', currentUser.email);
                        return true;
                    } else {
                        console.log('⚠️ No Firebase authentication found');
                    }
                } else {
                    console.log('⚠️ Firebase not initialized');
                }
                
                const localUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                if (localUser.email) {
                    console.log('📦 localStorage user:', localUser.email);
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('❌ Error checking auth:', error);
                return false;
            }
        }
        
        // Add login reminder for users
        function showLoginReminder() {
            const isAuthenticated = checkAuthStatus();
            if (!isAuthenticated) {
                const reminder = document.createElement('div');
                reminder.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #fff3cd;
                    color: #856404;
                    padding: 15px;
                    border-radius: 8px;
                    border: 1px solid #ffeaa7;
                    z-index: 1000;
                    max-width: 300px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                `;
                reminder.innerHTML = `
                    <strong>⚠️ Authentication Required</strong><br>
                    <small>For permanent class deletion, please log in via the <a href="../login.html">login page</a> or <a href="../../class-deletion-diagnostic.html">diagnostic tool</a>.</small>
                `;
                document.body.appendChild(reminder);
                
                setTimeout(() => {
                    if (reminder.parentNode) {
                        reminder.parentNode.removeChild(reminder);
                    }
                }, 10000);
            }
        }

        // Modern Notification System
        function showNotification(message, type = 'info', duration = 4000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const iconMap = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-triangle',
                warning: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="${iconMap[type]}"></i>
                </div>
                <div class="notification-message">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after duration
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideInUp 0.3s ease-out reverse';
                    setTimeout(() => notification.remove(), 300);
                }
            }, duration);
        }

        // Modern Modal Functions
        function openClassModal() {
            const modal = document.getElementById('classModal');
            const modalTitle = document.getElementById('modalTitle');
            const submitBtn = document.getElementById('submitBtn');
            const studentsTab = document.getElementById('studentsTab');
            
            // Reset modal state
            currentEditingClassId = null;
            modalTitle.innerHTML = '<i class="fas fa-plus"></i> Create New Class';
            submitBtn.innerHTML = '<i class="fas fa-plus"></i> Create Class';
            studentsTab.style.display = 'none';
            
            // Reset form
            document.getElementById('classForm').reset();
            
            // Clear student form fields
            document.getElementById('studentName').value = '';
            document.getElementById('studentEmail').value = '';
            
            // Update button state
            updateAddStudentButton();
            
            // Show modal
            modal.classList.add('active');
            modal.style.display = 'flex';
        }

        function closeClassModal() {
            const modal = document.getElementById('classModal');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            const activeTab = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
            const activeContent = document.getElementById(`${tabName}TabContent`);
            
            if (activeTab) activeTab.classList.add('active');
            if (activeContent) activeContent.classList.add('active');
            
            // Update button state when switching to students tab
            if (tabName === 'students') {
                updateAddStudentButton();
            }
        }

        function switchStudentOption(option) {
            // Update tab buttons
            document.querySelectorAll('.student-option-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[onclick="switchStudentOption('${option}')"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Show/hide sections
            const addSection = document.getElementById('addStudentsSection');
            const viewSection = document.getElementById('viewStudentsSection');
            
            if (option === 'add') {
                addSection.style.display = 'block';
                viewSection.style.display = 'none';
            } else if (option === 'view') {
                addSection.style.display = 'none';
                viewSection.style.display = 'block';
                
                // Load students for viewing if we have a class selected
                if (currentEditingClassId) {
                    loadStudentsForView(currentEditingClassId);
                }
            }
        }

        function switchAddOption(option) {
            // Update tab buttons
            document.querySelectorAll('.add-option-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[onclick="switchAddOption('${option}')"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Show/hide forms
            const singleForm = document.getElementById('singleStudentForm');
            const bulkForm = document.getElementById('bulkStudentForm');
            
            if (option === 'single') {
                singleForm.style.display = 'block';
                bulkForm.style.display = 'none';
            } else if (option === 'bulk') {
                singleForm.style.display = 'none';
                bulkForm.style.display = 'block';
            }
        }

        function validateBulkStudents() {
            const bulkText = document.getElementById('bulkStudentText').value.trim();
            
            if (!bulkText) {
                showNotification('Please enter student data to validate.', 'error');
                return;
            }
            
            const studentsToValidate = parseBulkStudentText(bulkText);
            processValidation(studentsToValidate);
        }

        function addBulkStudents() {
            const bulkText = document.getElementById('bulkStudentText').value.trim();
            
            if (!bulkText) {
                showNotification('Please enter student data.', 'error');
                return;
            }
            
            if (!currentEditingClassId) {
                showNotification('Please save the class first before adding students.', 'error');
                return;
            }
            
            const studentsToAdd = parseBulkStudentText(bulkText);
            
            if (studentsToAdd.length === 0) {
                showNotification('No valid students found in the text.', 'error');
                return;
            }
            
            const classes = JSON.parse(localStorage.getItem('teacherClasses') || '[]');
            const classIndex = classes.findIndex(cls => cls.id === currentEditingClassId);
            
            if (classIndex === -1) {
                showNotification('Class not found!', 'error');
                return;
            }
            
            if (!classes[classIndex].students) {
                classes[classIndex].students = [];
            }
            
            let addedCount = 0;
            let duplicateCount = 0;
            
            studentsToAdd.forEach(student => {
                // Check if student already exists
                if (classes[classIndex].students.some(s => s.email.toLowerCase() === student.email.toLowerCase())) {
                    duplicateCount++;
                } else {
                    const newStudent = {
                        id: 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                        name: student.name,
                        email: student.email,
                        addedAt: new Date().toISOString()
                    };
                    classes[classIndex].students.push(newStudent);
                    addedCount++;
                }
            });
            
            localStorage.setItem('teacherClasses', JSON.stringify(classes));
            
            // Clear form
            document.getElementById('bulkStudentText').value = '';
            
            // Update displays
            loadClasses();
            updateStats();
            
            // Show result
            let message = `${addedCount} student(s) added successfully!`;
            if (duplicateCount > 0) {
                message += ` ${duplicateCount} duplicate(s) skipped.`;
            }
            
            showNotification(message, 'success');
        }

        function parseBulkStudentText(text) {
            const lines = text.split('\n');
            const students = [];
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine) {
                    const parts = trimmedLine.split(',');
                    if (parts.length >= 2) {
                        const name = parts[0].trim();
                        const email = parts[1].trim();
                        
                        // Basic validation
                        if (name && email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                            students.push({ name, email });
                        }
                    }
                }
            });
            
            return students;
        }

        function processValidation(students) {
            const validationResults = document.getElementById('bulkValidationResults');
            
            if (students.length === 0) {
                validationResults.innerHTML = `
                    <div class="validation-section error">
                        <h5><i class="fas fa-exclamation-triangle"></i> No Valid Students Found</h5>
                        <p>Please check the format. Each line should contain: Name, Email</p>
                    </div>
                `;
                validationResults.style.display = 'block';
                return;
            }
            
            validationResults.innerHTML = `
                <div class="validation-section success">
                    <h5><i class="fas fa-check-circle"></i> ${students.length} Valid Students Found</h5>
                    <div class="student-preview">
                        ${students.slice(0, 5).map(student => `
                            <div class="student-preview-item">
                                <div>
                                    <div class="student-name">${student.name}</div>
                                    <div class="student-email">${student.email}</div>
                                </div>
                            </div>
                        `).join('')}
                        ${students.length > 5 ? `<p><small>... and ${students.length - 5} more</small></p>` : ''}
                    </div>
                </div>
            `;
            validationResults.style.display = 'block';
        }

        function updateAddStudentButton() {
            const addStudentBtn = document.getElementById('addStudentBtn');
            const bulkAddBtn = document.querySelector('#bulkStudentForm .btn');
            const helpText = document.getElementById('studentFormHelpText');
            const helpDiv = document.getElementById('studentFormHelp');
            
            if (currentEditingClassId) {
                // Enable buttons
                if (addStudentBtn) {
                    addStudentBtn.disabled = false;
                    addStudentBtn.innerHTML = '<i class="fas fa-user-plus"></i> Add Student';
                    addStudentBtn.title = 'Click to add this student to the class';
                }
                if (bulkAddBtn) {
                    bulkAddBtn.disabled = false;
                    bulkAddBtn.title = 'Click to add students in bulk';
                }
                
                // Update help text
                if (helpText) {
                    helpText.textContent = 'Fill in the student details below and click "Add Student" to add them to the class.';
                }
                if (helpDiv) {
                    helpDiv.style.background = 'var(--success-50)';
                    helpDiv.style.borderLeftColor = 'var(--success-500)';
                    const icon = helpDiv.querySelector('i');
                    if (icon) {
                        icon.style.color = 'var(--success-500)';
                        icon.className = 'fas fa-check-circle';
                    }
                }
            } else {
                // Disable buttons
                if (addStudentBtn) {
                    addStudentBtn.disabled = true;
                    addStudentBtn.innerHTML = '<i class="fas fa-save"></i> Save Class First';
                    addStudentBtn.title = 'Please save the class first before adding students';
                }
                if (bulkAddBtn) {
                    bulkAddBtn.disabled = true;
                    bulkAddBtn.title = 'Please save the class first before adding students';
                }
                
                // Update help text
                if (helpText) {
                    helpText.textContent = 'Save the class first to enable adding students.';
                }
                if (helpDiv) {
                    helpDiv.style.background = 'var(--primary-50)';
                    helpDiv.style.borderLeftColor = 'var(--primary-500)';
                    const icon = helpDiv.querySelector('i');
                    if (icon) {
                        icon.style.color = 'var(--primary-500)';
                        icon.className = 'fas fa-info-circle';
                    }
                }
            }
        }

        // Check authentication status
        function checkAuthStatus() {
            try {
                if (window.firebaseDataManager && window.firebaseDataManager.isInitialized) {
                    const currentUser = window.firebaseDataManager.getCurrentUser();
                    if (currentUser) {
                        console.log('✅ Firebase authenticated as:', currentUser.email);
                        return true;
                    } else {
                        console.log('⚠️ No Firebase authentication found');
                    }
                } else {
                    console.log('⚠️ Firebase not initialized');
                }
                
                const localUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                if (localUser.email) {
                    console.log('📦 localStorage user:', localUser.email);
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('❌ Error checking auth:', error);
                return false;
            }
        }
        
        // Add login reminder for users
        function showLoginReminder() {
            const isAuthenticated = checkAuthStatus();
            if (!isAuthenticated) {
                const reminder = document.createElement('div');
                reminder.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #fff3cd;
                    color: #856404;
                    padding: 15px;
                    border-radius: 8px;
                    border: 1px solid #ffeaa7;
                    z-index: 1000;
                    max-width: 300px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                `;
                reminder.innerHTML = `
                    <strong>⚠️ Authentication Required</strong><br>
                    <small>For permanent class deletion, please log in via the <a href="../login.html">login page</a> or <a href="../../class-deletion-diagnostic.html">diagnostic tool</a>.</small>
                `;
                document.body.appendChild(reminder);
                
                setTimeout(() => {
                    if (reminder.parentNode) {
                        reminder.parentNode.removeChild(reminder);
                    }
                }, 10000);
            }
        }

        // ...existing code...
    </script>
</body>
</html>
