<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publish Test - GestureQuiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #0284c7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0369a1;
        }
        .btn-success {
            background: #22c55e;
        }
        .btn-success:hover {
            background: #16a34a;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #22c55e;
        }
        .status.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #ef4444;
        }
        .quiz-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ Quiz Creation & Publish Test</h1>
    
    <div class="test-section">
        <h2>Test Environment Setup</h2>
        <button class="btn" onclick="setupTestEnvironment()">Setup Test Environment</button>
        <button class="btn" onclick="clearAllData()">Clear All Data</button>
        <div id="setupStatus"></div>
    </div>

    <div class="test-section">
        <h2>Test Quiz Creation Flow</h2>
        <button class="btn" onclick="createTestQuiz()">Create Test Quiz</button>
        <div id="createStatus"></div>
        <div id="quizData"></div>
    </div>

    <div class="test-section">
        <h2>Test Publish Flow</h2>
        <button class="btn" onclick="testPublishDraft()">Test Publish Draft</button>
        <button class="btn btn-success" onclick="testPublishNow()">Test Publish Now</button>
        <div id="publishStatus"></div>
    </div>

    <div class="test-section">
        <h2>Storage Debug</h2>
        <button class="btn" onclick="showStorageContents()">Show Storage Contents</button>
        <div id="storageContents"></div>
    </div>

    <script>
        // Test environment setup
        function setupTestEnvironment() {
            const testUser = {
                email: 'test@teacher.com',
                name: 'Test Teacher',
                role: 'teacher',
                department: 'Computer Science'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(testUser));
            
            document.getElementById('setupStatus').innerHTML = 
                '<div class="status success">‚úÖ Test environment setup complete</div>';
        }

        function clearAllData() {
            localStorage.removeItem('gestureQuizzes');
            localStorage.removeItem('currentUser');
            
            document.getElementById('setupStatus').innerHTML = 
                '<div class="status success">‚úÖ All data cleared</div>';
        }

        // Create test quiz
        function createTestQuiz() {
            const testQuiz = {
                id: 'quiz_test_' + Date.now(),
                title: 'Test Quiz for Publish',
                description: 'A test quiz to verify the publish functionality',
                category: 'General',
                difficulty: 'Easy',
                questions: [
                    {
                        id: '1',
                        text: 'What gesture means "thumbs up"?',
                        options: [
                            { text: 'Thumbs up', gesture: 'üëç' },
                            { text: 'Peace sign', gesture: '‚úåÔ∏è' },
                            { text: 'OK sign', gesture: 'üëå' },
                            { text: 'High five', gesture: '‚úã' }
                        ],
                        correctAnswer: 0
                    },
                    {
                        id: '2',
                        text: 'What gesture means "peace"?',
                        options: [
                            { text: 'Thumbs up', gesture: 'üëç' },
                            { text: 'Peace sign', gesture: '‚úåÔ∏è' },
                            { text: 'OK sign', gesture: 'üëå' },
                            { text: 'High five', gesture: '‚úã' }
                        ],
                        correctAnswer: 1
                    }
                ],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: 'test@teacher.com',
                status: 'draft',
                published: false
            };

            // Store globally for testing
            window.testQuizData = testQuiz;
            
            document.getElementById('createStatus').innerHTML = 
                '<div class="status success">‚úÖ Test quiz created successfully</div>';
            
            document.getElementById('quizData').innerHTML = 
                '<div class="quiz-data">' + JSON.stringify(testQuiz, null, 2) + '</div>';
        }

        // Test publish as draft
        function testPublishDraft() {
            if (!window.testQuizData) {
                document.getElementById('publishStatus').innerHTML = 
                    '<div class="status error">‚ùå No test quiz found. Create one first.</div>';
                return;
            }

            const quizData = { ...window.testQuizData };
            quizData.status = 'draft';
            quizData.published = false;
            
            const quizzes = JSON.parse(localStorage.getItem('gestureQuizzes') || '[]');
            
            // Remove existing test quiz if it exists
            const existingIndex = quizzes.findIndex(q => q.id === quizData.id);
            if (existingIndex !== -1) {
                quizzes.splice(existingIndex, 1);
            }
            
            quizzes.push(quizData);
            localStorage.setItem('gestureQuizzes', JSON.stringify(quizzes));
            
            document.getElementById('publishStatus').innerHTML = 
                '<div class="status success">‚úÖ Quiz saved as draft successfully</div>';
        }

        // Test publish now
        function testPublishNow() {
            if (!window.testQuizData) {
                document.getElementById('publishStatus').innerHTML = 
                    '<div class="status error">‚ùå No test quiz found. Create one first.</div>';
                return;
            }

            const quizData = { ...window.testQuizData };
            quizData.status = 'published';
            quizData.published = true;
            quizData.publishedAt = new Date().toISOString();
            
            const quizzes = JSON.parse(localStorage.getItem('gestureQuizzes') || '[]');
            
            // Remove existing test quiz if it exists
            const existingIndex = quizzes.findIndex(q => q.id === quizData.id);
            if (existingIndex !== -1) {
                quizzes.splice(existingIndex, 1);
            }
            
            quizzes.push(quizData);
            localStorage.setItem('gestureQuizzes', JSON.stringify(quizzes));
            
            document.getElementById('publishStatus').innerHTML = 
                '<div class="status success">‚úÖ Quiz published successfully</div>';
        }

        // Show storage contents
        function showStorageContents() {
            const quizzes = JSON.parse(localStorage.getItem('gestureQuizzes') || '[]');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            
            const contents = {
                currentUser: currentUser,
                quizzes: quizzes,
                quizCount: quizzes.length,
                publishedQuizzes: quizzes.filter(q => q.published).length,
                draftQuizzes: quizzes.filter(q => !q.published).length
            };
            
            document.getElementById('storageContents').innerHTML = 
                '<div class="quiz-data">' + JSON.stringify(contents, null, 2) + '</div>';
        }

        // Initialize
        window.addEventListener('load', function() {
            setupTestEnvironment();
            showStorageContents();
        });
    </script>
</body>
</html>
