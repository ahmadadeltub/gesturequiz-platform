<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - GestureQuiz</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .register-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 450px;
            width: 100%;
        }

        .register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .register-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .register-header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .register-form {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .role-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .role-option {
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .role-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .role-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .role-option i {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        .role-option h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .role-option p {
            font-size: 12px;
            opacity: 0.8;
        }

        .additional-fields {
            display: none;
        }

        .additional-fields.show {
            display: block;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #ccc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .submit-btn.enabled {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        .submit-btn.enabled:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .login-link {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .login-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #fcc;
            display: none;
        }

        .success-message {
            background: #efe;
            color: #363;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #cfc;
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 11px;
            max-width: 300px;
            z-index: 9999;
        }

        @media (max-width: 480px) {
            .register-container {
                margin: 10px;
            }
            .register-form {
                padding: 20px;
            }
            .role-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo">
        Status: Page loading...
    </div>

    <div class="register-container">
        <div class="register-header">
            <h1><i class="fas fa-graduation-cap"></i> Join GestureQuiz</h1>
            <p>Create your account to start learning</p>
        </div>

        <div class="register-form">
            <div id="errorMessage" class="error-message"></div>
            <div id="successMessage" class="success-message"></div>

            <form id="registrationForm" novalidate>
                <!-- Role Selection -->
                <div class="form-group">
                    <label>I am a:</label>
                    <div class="role-selection">
                        <div class="role-option" data-role="teacher">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <h3>Teacher</h3>
                            <p>Create classes and quizzes</p>
                        </div>
                        <div class="role-option" data-role="student">
                            <i class="fas fa-user-graduate"></i>
                            <h3>Student</h3>
                            <p>Take quizzes and learn</p>
                        </div>
                    </div>
                </div>

                <!-- Basic Information -->
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label for="password">Password *</label>
                    <input type="password" id="password" name="password" required placeholder="Create a strong password">
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password *</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="Confirm your password">
                </div>

                <!-- Teacher Additional Fields -->
                <div id="teacherFields" class="additional-fields">
                    <div class="form-group">
                        <label for="school">School/Institution</label>
                        <input type="text" id="school" name="school" placeholder="Your school or institution">
                    </div>

                    <div class="form-group">
                        <label for="department">Department/Subject</label>
                        <input type="text" id="department" name="department" placeholder="e.g., Mathematics, Science, English">
                    </div>

                    <div class="form-group">
                        <label for="teacherBio">Bio (Optional)</label>
                        <textarea id="teacherBio" name="teacherBio" rows="3" placeholder="Tell us about yourself and your teaching experience"></textarea>
                    </div>
                </div>

                <!-- Student Additional Fields -->
                <div id="studentFields" class="additional-fields">
                    <div class="form-group">
                        <label for="grade">Grade Level *</label>
                        <select id="grade" name="grade">
                            <option value="">Select your grade</option>
                            <optgroup label="Elementary School">
                                <option value="1st Grade">1st Grade</option>
                                <option value="2nd Grade">2nd Grade</option>
                                <option value="3rd Grade">3rd Grade</option>
                                <option value="4th Grade">4th Grade</option>
                                <option value="5th Grade">5th Grade</option>
                                <option value="6th Grade">6th Grade</option>
                            </optgroup>
                            <optgroup label="Middle School">
                                <option value="7th Grade">7th Grade</option>
                                <option value="8th Grade">8th Grade</option>
                                <option value="9th Grade">9th Grade</option>
                            </optgroup>
                            <optgroup label="High School">
                                <option value="10th Grade">10th Grade</option>
                                <option value="11th Grade">11th Grade</option>
                                <option value="12th Grade">12th Grade</option>
                            </optgroup>
                            <optgroup label="Higher Education">
                                <option value="College Freshman">College Freshman</option>
                                <option value="College Sophomore">College Sophomore</option>
                                <option value="College Junior">College Junior</option>
                                <option value="College Senior">College Senior</option>
                                <option value="Graduate">Graduate Student</option>
                                <option value="Adult Learner">Adult Learner</option>
                            </optgroup>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="studentSchool">School Name</label>
                        <input type="text" id="studentSchool" name="studentSchool" placeholder="Enter your school name">
                    </div>

                    <div class="form-group">
                        <label for="interests">Academic Interests</label>
                        <input type="text" id="interests" name="interests" placeholder="e.g., Mathematics, Science, Literature, Art">
                    </div>
                </div>

                <button type="button" class="submit-btn" id="submitBtn">
                    <i class="fas fa-user-plus"></i>
                    Create Account
                </button>
            </form>

            <div class="login-link">
                Already have an account? <a href="login.html">Sign in here</a>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt4ByDMxZFT00a-zESwNHS8uv3DY08uhg",
            authDomain: "gesturequiz-platform-live.firebaseapp.com",
            projectId: "gesturequiz-platform-live",
            storageBucket: "gesturequiz-platform-live.firebasestorage.app",
            messagingSenderId: "794242095954",
            appId: "1:794242095954:web:85868edc63c96d37ea388b",
            measurementId: "G-Y7WPTJRVG6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();
        
        console.log('✅ Firebase initialized successfully');
    </script>

    <script>
        let selectedRole = '';
        let debugLog = [];

        function updateDebug(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            if (debugLog.length > 8) debugLog.shift();
            
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.innerHTML = debugLog.join('<br>');
            console.log(`🔍 DEBUG: ${message}`);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            successDiv.style.display = 'none';
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            updateDebug(`ERROR: ${message}`);
        }

        function showSuccess(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            errorDiv.style.display = 'none';
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            updateDebug(`SUCCESS: ${message}`);
        }

        function handleRegistration() {
            updateDebug('Registration started');
            
            if (!selectedRole) {
                showError('Please select whether you are a teacher or student.');
                return;
            }

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validation
            if (!fullName || !email || !password || !confirmPassword) {
                showError('Please fill in all required fields.');
                return;
            }

            if (password !== confirmPassword) {
                showError('Passwords do not match.');
                return;
            }

            if (password.length < 6) {
                showError('Password must be at least 6 characters long.');
                return;
            }

            // Student role validation
            if (selectedRole === 'student') {
                const grade = document.getElementById('grade').value;
                if (!grade) {
                    showError('Please select your grade level.');
                    return;
                }
            }

            // Disable submit button
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading"></div> Creating Account...';
            submitBtn.classList.remove('enabled');

            updateDebug('Creating Firebase account...');

            // Create account
            auth.createUserWithEmailAndPassword(email, password)
                .then(async (userCredential) => {
                    const user = userCredential.user;
                    updateDebug(`Firebase Auth created: ${user.uid}`);

                    // Prepare user data
                    const userData = {
                        name: fullName,
                        email: email,
                        role: selectedRole,
                        avatar: selectedRole === 'teacher' ? '👨‍🏫' : '👨‍🎓',
                        isVerified: false,
                        createdAt: new Date().toISOString(),
                        uid: user.uid
                    };

                    // Add role-specific data
                    if (selectedRole === 'teacher') {
                        userData.school = document.getElementById('school').value || '';
                        userData.department = document.getElementById('department').value || '';
                        userData.bio = document.getElementById('teacherBio').value || '';
                        userData.classes = [];
                        userData.totalQuizzes = 0;
                    } else {
                        userData.grade = document.getElementById('grade').value;
                        userData.school = document.getElementById('studentSchool').value || '';
                        userData.interests = document.getElementById('interests').value ? 
                            document.getElementById('interests').value.split(',').map(s => s.trim()) : [];
                        userData.enrolledClasses = [];
                        userData.completedQuizzes = 0;
                        userData.totalPoints = 0;
                    }

                    updateDebug('Saving to Firestore...');

                    // Save to Firestore
                    await db.collection('users').doc(user.uid).set(userData);
                    
                    updateDebug('Account created successfully!');
                    showSuccess('Account created successfully! Redirecting...');
                    
                    // Store user data locally
                    localStorage.setItem('currentUser', JSON.stringify(userData));

                    // Redirect after 2 seconds
                    setTimeout(() => {
                        if (selectedRole === 'teacher') {
                            window.location.href = 'pages/teacher-dashboard.html';
                        } else {
                            window.location.href = 'pages/student-dashboard.html';
                        }
                    }, 2000);

                })
                .catch((error) => {
                    console.error('Registration error:', error);
                    updateDebug(`Registration failed: ${error.code}`);
                    
                    let errorMessage = 'An error occurred during registration.';
                    
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'An account with this email already exists.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Please enter a valid email address.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Password should be at least 6 characters.';
                    } else if (error.code === 'auth/network-request-failed') {
                        errorMessage = 'Network error. Please check your internet connection.';
                    }
                    
                    showError(errorMessage);

                    // Re-enable submit button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
                    if (selectedRole) {
                        submitBtn.classList.add('enabled');
                    }
                });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateDebug('Page loaded - setting up events');

            // Role selection
            document.querySelectorAll('.role-option').forEach(option => {
                option.addEventListener('click', function() {
                    updateDebug(`Role selected: ${this.dataset.role}`);
                    
                    // Remove previous selection
                    document.querySelectorAll('.role-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Select this role
                    this.classList.add('selected');
                    selectedRole = this.dataset.role;
                    
                    // Enable submit button
                    const submitBtn = document.getElementById('submitBtn');
                    submitBtn.disabled = false;
                    submitBtn.classList.add('enabled');
                    
                    // Show/hide additional fields and manage required attributes
                    const teacherFields = document.getElementById('teacherFields');
                    const studentFields = document.getElementById('studentFields');
                    const gradeSelect = document.getElementById('grade');
                    
                    if (selectedRole === 'teacher') {
                        teacherFields.classList.add('show');
                        studentFields.classList.remove('show');
                        // Remove required attribute from grade when teacher is selected
                        gradeSelect.removeAttribute('required');
                    } else {
                        teacherFields.classList.remove('show');
                        studentFields.classList.add('show');
                        // Add required attribute to grade when student is selected
                        gradeSelect.setAttribute('required', 'required');
                    }
                    
                    updateDebug(`Submit button enabled: ${selectedRole}`);
                });
            });

            // Submit button click
            document.getElementById('submitBtn').addEventListener('click', function() {
                updateDebug('Submit button clicked');
                handleRegistration();
            });

            updateDebug('Ready - select a role to enable registration');
        });
    </script>
</body>
</html>
