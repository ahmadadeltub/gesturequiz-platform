<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ GestureQuiz Platform - Rules Updated Success Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        .success-header {
            background: linear-gradient(45deg, #38a169, #2f855a);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(56, 161, 105, 0.3);
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #38a169;
        }
        .test-results {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            margin: 15px 0;
            min-height: 80px;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #38a169;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin: 10px 5px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #2f855a;
            transform: translateY(-2px);
        }
        .btn-primary {
            background: #4299e1;
        }
        .btn-primary:hover {
            background: #3182ce;
        }
        .status-box {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
        }
        .status-good {
            background: #c6f6d5;
            border: 2px solid #38a169;
            color: #1a202c;
        }
        .status-bad {
            background: #fed7d7;
            border: 2px solid #e53e3e;
            color: #1a202c;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .quick-links {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 25px 0;
        }
        .celebration {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-header">
            <div class="celebration">ğŸ‰ğŸš€âœ¨</div>
            <h1>Firebase Rules Updated Successfully!</h1>
            <p>Testing complete platform functionality after rules update</p>
            <p><strong>Website:</strong> https://gesturequiz-platform-live.web.app</p>
        </div>

        <div class="test-section">
            <h2>ğŸ” Step 1: Test Firestore Access</h2>
            <p>Verify that Firestore rules are working correctly:</p>
            <button class="btn" onclick="testFirestoreAccess()">ğŸ”¥ Test Firestore Rules</button>
            <div id="firestoreTest" class="test-results">
                Click the button above to test Firestore access...
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ‘¤ Step 2: Test Registration</h2>
            <p>Try registering a new account to verify the complete flow:</p>
            
            <div class="form-group">
                <label for="regEmail">Email:</label>
                <input type="email" id="regEmail" placeholder="test@example.com">
            </div>
            
            <div class="form-group">
                <label for="regPassword">Password:</label>
                <input type="password" id="regPassword" placeholder="testpassword123">
            </div>
            
            <button class="btn" onclick="testRegistration()">ğŸ“ Test Registration</button>
            <div id="registrationTest" class="test-results">
                Enter credentials above and test registration...
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”‘ Step 3: Test Login</h2>
            <p>Test login functionality with the account created above:</p>
            <button class="btn" onclick="testLogin()">ğŸ” Test Login</button>
            <div id="loginTest" class="test-results">
                Click to test login with the credentials above...
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š Step 4: Test Data Operations</h2>
            <p>Test reading and writing user data to Firestore:</p>
            <button class="btn" onclick="testDataOperations()">ğŸ’¾ Test Data Read/Write</button>
            <div id="dataTest" class="test-results">
                Click to test data operations...
            </div>
        </div>

        <div id="overallStatus" class="status-box">
            <strong>ğŸ”„ Run all tests above to get overall platform status...</strong>
        </div>

        <div class="quick-links">
            <h2>ğŸŒ Platform Links</h2>
            <a href="https://gesturequiz-platform-live.web.app" target="_blank" class="btn" style="background: rgba(255,255,255,0.2); border: 2px solid white;">ğŸ  Live Website</a>
            <a href="https://gesturequiz-platform-live.web.app/quiz-app/register.html" target="_blank" class="btn" style="background: rgba(255,255,255,0.2); border: 2px solid white;">ğŸ“ Registration Page</a>
            <a href="https://gesturequiz-platform-live.web.app/quiz-app/login.html" target="_blank" class="btn" style="background: rgba(255,255,255,0.2); border: 2px solid white;">ğŸ”‘ Login Page</a>
            <a href="https://console.firebase.google.com/project/gesturequiz-platform-live" target="_blank" class="btn" style="background: rgba(255,255,255,0.2); border: 2px solid white;">âš™ï¸ Firebase Console</a>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt4ByDMxZFT00a-zESwNHS8uv3DY08uhg",
            authDomain: "gesturequiz-platform-live.firebaseapp.com",
            projectId: "gesturequiz-platform-live",
            storageBucket: "gesturequiz-platform-live.firebasestorage.app",
            messagingSenderId: "794242095954",
            appId: "1:794242095954:web:85868edc63c96d37ea388b",
            measurementId: "G-Y7WPTJRVG6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let testResults = {
            firestore: false,
            registration: false,
            login: false,
            data: false
        };

        function testFirestoreAccess() {
            const statusDiv = document.getElementById('firestoreTest');
            statusDiv.innerHTML = 'ğŸ”„ Testing Firestore access...';
            
            // Test read access to a test collection
            db.collection('test').limit(1).get()
                .then((querySnapshot) => {
                    statusDiv.innerHTML = `
                        <div style="color: #48bb78;">âœ… SUCCESS: Firestore rules are working!</div>
                        <div>ğŸ“Š Read access: Granted</div>
                        <div>ğŸ” Rules: Properly configured</div>
                        <div>â° Tested at: ${new Date().toLocaleTimeString()}</div>
                    `;
                    testResults.firestore = true;
                    updateOverallStatus();
                })
                .catch((error) => {
                    if (error.code === 'permission-denied') {
                        statusDiv.innerHTML = `
                            <div style="color: #f56565;">âŒ ERROR: Firestore rules still restrictive</div>
                            <div>ğŸš¨ Issue: Permission denied</div>
                            <div>ğŸ’¡ Solution: Double-check rules were published in Firebase Console</div>
                            <div>â° Failed at: ${new Date().toLocaleTimeString()}</div>
                        `;
                    } else {
                        statusDiv.innerHTML = `
                            <div style="color: #ed8936;">âš ï¸ WARNING: ${error.message}</div>
                            <div>ğŸ”§ Code: ${error.code}</div>
                            <div>â° Failed at: ${new Date().toLocaleTimeString()}</div>
                        `;
                    }
                    testResults.firestore = false;
                    updateOverallStatus();
                });
        }

        function testRegistration() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const statusDiv = document.getElementById('registrationTest');
            
            if (!email || !password) {
                statusDiv.innerHTML = '<div style="color: #f56565;">âŒ Please enter both email and password</div>';
                return;
            }
            
            statusDiv.innerHTML = `ğŸ”„ Testing registration for: ${email}...`;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    statusDiv.innerHTML = `
                        <div style="color: #48bb78;">ğŸ‰ SUCCESS: Registration working perfectly!</div>
                        <div>ğŸ‘¤ User ID: ${user.uid}</div>
                        <div>ğŸ“§ Email: ${user.email}</div>
                        <div>â° Created at: ${new Date().toLocaleTimeString()}</div>
                    `;
                    testResults.registration = true;
                    updateOverallStatus();
                    
                    // Auto-save user data to Firestore
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        testAccount: true
                    });
                })
                .then(() => {
                    statusDiv.innerHTML += `<br><div style="color: #48bb78;">ğŸ“Š User data saved to Firestore successfully!</div>`;
                })
                .catch((error) => {
                    if (error.code === 'auth/email-already-in-use') {
                        statusDiv.innerHTML = `
                            <div style="color: #ed8936;">âš ï¸ INFO: Email already registered</div>
                            <div>ğŸ’¡ This means registration is working - try a different email</div>
                            <div>â° At: ${new Date().toLocaleTimeString()}</div>
                        `;
                        testResults.registration = true;
                    } else {
                        statusDiv.innerHTML = `
                            <div style="color: #f56565;">âŒ Registration failed: ${error.message}</div>
                            <div>ğŸ”§ Code: ${error.code}</div>
                            <div>â° Failed at: ${new Date().toLocaleTimeString()}</div>
                        `;
                        testResults.registration = false;
                    }
                    updateOverallStatus();
                });
        }

        function testLogin() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const statusDiv = document.getElementById('loginTest');
            
            if (!email || !password) {
                statusDiv.innerHTML = '<div style="color: #f56565;">âŒ Please enter email and password in Step 2 first</div>';
                return;
            }
            
            statusDiv.innerHTML = `ğŸ”„ Testing login for: ${email}...`;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    statusDiv.innerHTML = `
                        <div style="color: #48bb78;">ğŸ‰ SUCCESS: Login working perfectly!</div>
                        <div>ğŸ‘¤ User ID: ${user.uid}</div>
                        <div>ğŸ“§ Email: ${user.email}</div>
                        <div>â° Logged in at: ${new Date().toLocaleTimeString()}</div>
                    `;
                    testResults.login = true;
                    updateOverallStatus();
                })
                .catch((error) => {
                    statusDiv.innerHTML = `
                        <div style="color: #f56565;">âŒ Login failed: ${error.message}</div>
                        <div>ğŸ”§ Code: ${error.code}</div>
                        <div>ğŸ’¡ Try registering first if account doesn't exist</div>
                        <div>â° Failed at: ${new Date().toLocaleTimeString()}</div>
                    `;
                    testResults.login = false;
                    updateOverallStatus();
                });
        }

        function testDataOperations() {
            const statusDiv = document.getElementById('dataTest');
            
            auth.onAuthStateChanged((user) => {
                if (!user) {
                    statusDiv.innerHTML = '<div style="color: #f56565;">âŒ Please register and login first</div>';
                    return;
                }
                
                statusDiv.innerHTML = 'ğŸ”„ Testing data read/write operations...';
                
                const testData = {
                    testMessage: 'Hello from GestureQuiz!',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: user.uid,
                    testComplete: true
                };
                
                // Test write
                db.collection('users').doc(user.uid).update(testData)
                    .then(() => {
                        statusDiv.innerHTML = '<div style="color: #48bb78;">âœ… Write test successful!</div>';
                        
                        // Test read
                        return db.collection('users').doc(user.uid).get();
                    })
                    .then((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            statusDiv.innerHTML += `
                                <br><div style="color: #48bb78;">âœ… Read test successful!</div>
                                <div>ğŸ“Š Data retrieved: ${data.testMessage}</div>
                                <div>ğŸ‰ COMPLETE SUCCESS: All data operations working!</div>
                                <div>â° Completed at: ${new Date().toLocaleTimeString()}</div>
                            `;
                            testResults.data = true;
                        } else {
                            statusDiv.innerHTML += '<br><div style="color: #f56565;">âŒ Read test failed: Document not found</div>';
                            testResults.data = false;
                        }
                        updateOverallStatus();
                    })
                    .catch((error) => {
                        statusDiv.innerHTML += `
                            <br><div style="color: #f56565;">âŒ Data operation failed: ${error.message}</div>
                            <div>ğŸ”§ Code: ${error.code}</div>
                        `;
                        testResults.data = false;
                        updateOverallStatus();
                    });
            });
        }

        function updateOverallStatus() {
            const statusDiv = document.getElementById('overallStatus');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(Boolean).length;
            
            if (passed === total) {
                statusDiv.className = 'status-box status-good';
                statusDiv.innerHTML = `
                    <div style="font-size: 1.5em;">ğŸ‰ PLATFORM FULLY FUNCTIONAL!</div>
                    <div>âœ… All tests passed (${passed}/${total})</div>
                    <div>ğŸš€ Your GestureQuiz platform is ready for users!</div>
                    <div>ğŸŒ Live at: https://gesturequiz-platform-live.web.app</div>
                `;
            } else if (passed > 0) {
                statusDiv.className = 'status-box';
                statusDiv.innerHTML = `
                    <div>ğŸ”„ Testing in progress...</div>
                    <div>ğŸ“Š Tests passed: ${passed}/${total}</div>
                    <div>Continue running tests above</div>
                `;
            } else {
                statusDiv.className = 'status-box';
                statusDiv.innerHTML = `
                    <div>ğŸ”„ Run all tests above to get overall platform status...</div>
                `;
            }
        }

        // Auto-run Firestore test when page loads
        window.addEventListener('load', () => {
            setTimeout(testFirestoreAccess, 1000);
        });
    </script>
</body>
</html>
